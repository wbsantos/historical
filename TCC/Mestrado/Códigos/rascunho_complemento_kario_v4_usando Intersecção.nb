(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    135589,       3379]
NotebookOptionsPosition[    130146,       3200]
NotebookOutlinePosition[    130492,       3215]
CellTagsIndexPosition[    130449,       3212]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"<<", "CATemplates`"}]], "Input",
 CellChangeTimes->{{3.7215507395650854`*^9, 3.721550740190138*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ChangeSymbols", "[", "core_List", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"newCore", "=", "core"}], ",", 
      RowBox[{"coreSymbols", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"core", ",", "#"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "1"}], "&"}]}],
              "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", 
         RowBox[{"DeleteDuplicates", "[", 
          RowBox[{"Select", "[", 
           RowBox[{"core", ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "0"}], "&&", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "0", "]"}], "]"}], "===", "Symbol"}]}], "&"}]}], 
           "]"}], "]"}]}], "]"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "\[LessEqual]", 
        RowBox[{"Length", "[", "coreSymbols", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", 
       RowBox[{"newCore", "=", 
        RowBox[{"(", 
         RowBox[{"newCore", "/.", 
          RowBox[{
           RowBox[{"core", "[", 
            RowBox[{"[", 
             RowBox[{"coreSymbols", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "\[Rule]", 
           RowBox[{"Symbol", "[", 
            RowBox[{"\"\<x\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{
               RowBox[{"Length", "[", "core", "]"}], "-", 
               RowBox[{"coreSymbols", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], "]"}]}]}], 
         ")"}]}]}], "]"}], ";", "\[IndentingNewLine]", "newCore"}]}], 
   "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Problema", ":", 
     RowBox[{
     "Nome", " ", "das", " ", "vari\[AAcute]veis", " ", "s\[ATilde]o", " ", 
      "muito", " ", "importantes", " ", "para", " ", "correto", " ", 
      "funcionando"}]}], ",", 
    RowBox[{
    "mas", " ", "essa", " ", "depend\[EHat]ncia", " ", "n\[ATilde]o", " ", 
     "deveria", " ", "existis"}]}], "*)"}], 
  RowBox[{
   RowBox[{"ComplementaryTest", "[", "template1_Association", "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"baseTemplate", "=", 
       RowBox[{"BaseTemplateCore", "[", 
        RowBox[{
         RowBox[{"k", "[", "template1", "]"}], ",", 
         RowBox[{"r", "[", "template1", "]"}]}], "]"}]}], "}"}], ",", " ", 
     RowBox[{
      RowBox[{"complementEquation", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "&"}], "/@", 
             RowBox[{"Map", "[", 
              RowBox[{"(*", 
               RowBox[{
               "Iguala", " ", "cada", " ", "campo", " ", "calculado", " ", 
                "ao", " ", "MOD", " ", "respectivo", " ", "para", " ", 
                "realizar", " ", "a", " ", "nega\[CCedilla]\[ATilde]o", " ", 
                "do", " ", "valor", " ", "da", " ", 
                "equa\[CCedilla]\[ATilde]o"}], "*)"}], 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{"#", ",", "1"}], "]"}], "\[Equal]", 
                 RowBox[{"Mod", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "+", "w"}], ",", 
                   RowBox[{"k", "[", "template1", "]"}]}], "]"}]}], "&"}], 
               ",", 
               RowBox[{"Select", "[", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{
                  "Filtra", " ", "somente", " ", "as", " ", 
                   "posi\[CCedilla]\[OTilde]es", " ", "calculadas", " ", "do",
                    " ", "template"}], ",", 
                  RowBox[{
                  "ignorando", " ", "vari\[AAcute]veis", " ", "livres"}]}], 
                 "*)"}], 
                RowBox[{
                 RowBox[{"MapThread", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#1", "===", "#2"}], ",", "\"\<X\>\"", ",", 
                    RowBox[{"#1", "\[Equal]", "#2"}]}], "]"}], "&"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ChangeSymbols", "[", 
                    RowBox[{"BaseTemplateCore", "[", 
                    RowBox[{
                    RowBox[{"k", "[", "template1", "]"}], ",", 
                    RowBox[{"r", "[", "template1", "]"}]}], "]"}], "]"}], ",", 
                    RowBox[{"ChangeSymbols", "[", 
                    RowBox[{"templateCore", "[", "template1", "]"}], "]"}]}], 
                    "}"}]}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"Not", "[", 
                   RowBox[{"#", "===", "\"\<X\>\""}], "]"}], "&"}]}], "]"}]}],
               "]"}]}], ")"}], "/.", 
           RowBox[{"w", "\[Rule]", "#"}]}], " ", 
          RowBox[{"(*", 
           RowBox[{
           "Substitu\[IAcute]", " ", "a", " ", "vari\[AAcute]vel", " ", "w", 
            " ", "pelo", " ", "valor", " ", "respectivo", " ", "da", " ", 
            "iterea\[CCedilla]\[ATilde]o", " ", "do", " ", "MOD"}], "*)"}], 
          ")"}], "&"}], "/@", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Mapeia", " ", "cada", " ", "campo", " ", "calculado", " ", "com", 
           " ", "a", " ", "itera\[CCedilla]\[ATilde]o", " ", "de", " ", "1", 
           " ", "\[AGrave]", " ", "k"}], "-", 
          RowBox[{
          "1", " ", "para", " ", "realizar", " ", "a", " ", 
           "opera\[CCedilla]\[ATilde]o", " ", "de", " ", "MOD", " ", "da", 
           " ", "nega\[CCedilla]\[ATilde]o"}]}], "*)"}], 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{
           RowBox[{"k", "[", "template1", "]"}], "-", "1"}]}], "]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"listaComplemento", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"listaComplemento", ",", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", "\[Equal]", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], " ", "+", " ", "1"}], ")"}], 
              " ", "*", " ", 
              RowBox[{"(", 
               RowBox[{"1", " ", "-", " ", 
                RowBox[{"Floor", "[", 
                 RowBox[{
                  RowBox[{"Abs", "[", 
                   RowBox[{
                    RowBox[{"1", "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", "\[Equal]", 
                    " ", "2"}], ",", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "-", " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "+", "0.1"}], 
                    ")"}]}], "/", "10"}], "]"}], "+", "0.000000000001"}], 
                 "]"}]}], ")"}]}], "-", "1"}]}], "  ", "&"}], " ", ",", " ", 
          RowBox[{"complementEquation", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}], ";", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"e", " ", "=", " ", "2"}], ",", " ", 
        RowBox[{"e", " ", "\[LessEqual]", " ", 
         RowBox[{"Length", "[", "complementEquation", "]"}]}], ",", " ", 
        RowBox[{"e", "++"}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"listaComplemento", ",", " ", 
          RowBox[{"complementEquation", "[", 
           RowBox[{"[", "e", "]"}], "]"}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "listaComplemento"}]}], " ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"XMODK", "+", "1"}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"FLOOR", 
          RowBox[{"(", 
           RowBox[{"ABS", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"1", "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"X", "-", "XMODK"}], ")"}], "+", "0.1"}], ")"}]}], 
              "/", "10"}], ")"}]}], ")"}]}]}], ")"}]}], "-", "1"}], "*)"}], 
    "\[IndentingNewLine]", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7213119391967325`*^9, 3.7213119490152736`*^9}, 
   3.721315368814711*^9, {3.72131635172103*^9, 3.7213163754431705`*^9}, {
   3.721316442647564*^9, 3.7213165188606234`*^9}, {3.7213166022121687`*^9, 
   3.721316605003888*^9}, {3.7213166421627436`*^9, 3.721316692567815*^9}, {
   3.7213168375453367`*^9, 3.7213168384115353`*^9}, {3.721317141398978*^9, 
   3.72131717262553*^9}, {3.721317295855425*^9, 3.7213173489581857`*^9}, {
   3.721317440134726*^9, 3.721317489124405*^9}, {3.721317521238695*^9, 
   3.721317521727817*^9}, {3.7213175646389484`*^9, 3.721317565160084*^9}, {
   3.721317605059384*^9, 3.721317609546545*^9}, {3.721317641855908*^9, 
   3.721317725976706*^9}, {3.7213178675193386`*^9, 3.72131787069316*^9}, {
   3.7213179760094423`*^9, 3.721318051934579*^9}, {3.7213180979174805`*^9, 
   3.721318216004017*^9}, {3.7213182593742676`*^9, 3.7213183462302866`*^9}, {
   3.7213183917600803`*^9, 3.721318401416569*^9}, 3.7213184518556085`*^9, {
   3.721318507827112*^9, 3.721318509494525*^9}, {3.7213190483623037`*^9, 
   3.721319101121932*^9}, {3.721319150754806*^9, 3.721319222595502*^9}, {
   3.7213195561994905`*^9, 3.7213197899789944`*^9}, {3.7213198652264967`*^9, 
   3.7213198987401447`*^9}, {3.7213199347724943`*^9, 3.721319981086483*^9}, {
   3.7213207486355677`*^9, 3.7213207552582808`*^9}, {3.721320788105912*^9, 
   3.721320799448848*^9}, {3.721320852136484*^9, 3.721320853735899*^9}, {
   3.7213213425258017`*^9, 3.721321432604127*^9}, {3.721321524599275*^9, 
   3.721321527927408*^9}, {3.7213216050919495`*^9, 3.721321693558357*^9}, {
   3.7213217587806363`*^9, 3.7213218215381737`*^9}, {3.72132186764772*^9, 
   3.721321939598983*^9}, {3.7213413240642242`*^9, 3.7213413571907434`*^9}, {
   3.721342400431984*^9, 3.7213424061324854`*^9}, 3.7213461594355516`*^9, {
   3.721346322985114*^9, 3.7213463687858973`*^9}, {3.721346446442734*^9, 
   3.7213464612650046`*^9}, {3.7214269441444016`*^9, 3.721427059710376*^9}, {
   3.7214604488629746`*^9, 3.721460499384799*^9}, {3.721460554398514*^9, 
   3.7214606733691053`*^9}, 3.721460706574222*^9, {3.721460752846182*^9, 
   3.7214607612657146`*^9}, {3.7214608149125547`*^9, 3.721460816074007*^9}, {
   3.7214608950620437`*^9, 3.721460901806274*^9}, {3.7214611870097446`*^9, 
   3.721461197306642*^9}, {3.721507175495773*^9, 3.7215071794293833`*^9}, {
   3.7215072383943634`*^9, 3.721507355434341*^9}, 3.72150738627874*^9, {
   3.721508242561609*^9, 3.7215082567851663`*^9}}],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{"OperacaoDiferenca", "[", 
    RowBox[{"template1_Association", ",", "template2_Association"}], "]"}], 
   " ", ":=", " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"complementaryTemplate", " ", "=", " ", 
       RowBox[{"ComplementaryTest", "[", "template2", "]"}]}], " ", "}"}], 
     ",", 
     RowBox[{
      RowBox[{"totalItems", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "complementaryTemplate", "]"}], " ", ">", 
           " ", "0"}], " ", "&&", " ", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"complementaryTemplate", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", ">", " ", "0"}]}], 
         ",", "  ", 
         RowBox[{"Length", "[", 
          RowBox[{"complementaryTemplate", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", "0"}], "]"}]}], 
      ";", 
      RowBox[{"lista", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", " ", 
      RowBox[{"templates", " ", "=", 
       RowBox[{"{", "}"}]}], ";", " ", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"u", "=", "1"}], ",", 
        RowBox[{"u", "\[LessEqual]", "totalItems"}], ",", 
        RowBox[{"u", "++"}], ",", " ", 
        RowBox[{"AppendTo", "[", " ", 
         RowBox[{"lista", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "u", "]"}], "]"}], " ", "&"}], " ", "/@", "  ", 
           "complementaryTemplate"}]}], "]"}]}], "]"}], ";", " ", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"v", "=", "1"}], ",", 
        RowBox[{"v", "\[LessEqual]", 
         RowBox[{"Length", "[", "lista", "]"}]}], ",", 
        RowBox[{"v", "++"}], ",", " ", 
        RowBox[{"AppendTo", "[", " ", 
         RowBox[{"templates", ",", " ", 
          RowBox[{"BuildTemplate", "[", 
           RowBox[{
            RowBox[{"k", "[", "template1", "]"}], ",", 
            RowBox[{"r", "[", "template1", "]"}], ",", " ", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"#", " ", "===", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"lista", "[", 
                    RowBox[{"[", "v", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", "&"}], " ", "/@", 
                   " ", 
                   RowBox[{"lista", "[", 
                    RowBox[{"[", "v", "]"}], "]"}]}], ")"}], " ", ",", "#"}], 
                "]"}], " ", "&"}], ",", 
              RowBox[{"BaseTemplateCore", "[", 
               RowBox[{
                RowBox[{"k", "[", "template1", "]"}], ",", 
                RowBox[{"r", "[", "template1", "]"}]}], "]"}]}], "]"}]}], 
           "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"coreList", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"templateBase", " ", "=", " ", 
       RowBox[{"BuildTemplate", "[", 
        RowBox[{
         RowBox[{"k", "[", "template1", "]"}], ",", 
         RowBox[{"r", "[", "template1", "]"}], ",", " ", 
         RowBox[{"BaseTemplateCore", "[", 
          RowBox[{
           RowBox[{"k", "[", "template1", "]"}], ",", 
           RowBox[{"r", "[", "template1", "]"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"h", " ", "=", " ", "1"}], ",", 
        RowBox[{"h", "\[LessEqual]", " ", 
         RowBox[{"Length", "[", 
          RowBox[{"lista", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
        RowBox[{"h", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"t", "=", "1"}], ",", 
          RowBox[{"t", "\[LessEqual]", 
           RowBox[{"Length", "[", "lista", "]"}]}], ",", 
          RowBox[{"t", "++"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"coreList", ",", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"#", " ", "===", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"lista", "[", 
                    RowBox[{"[", "t", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", "&"}], " ", "/@", 
                    " ", 
                    RowBox[{"lista", "[", 
                    RowBox[{"[", "t", "]"}], "]"}]}], ")"}], "[", 
                  RowBox[{"[", "h", "]"}], "]"}], ",", " ", 
                 RowBox[{
                  RowBox[{"templateCore", "[", "templateBase", "]"}], "[", 
                  RowBox[{"[", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"BaseTemplateCore", "[", 
                    RowBox[{
                    RowBox[{"k", "[", "template1", "]"}], ",", 
                    RowBox[{"r", "[", "template1", "]"}]}], "]"}], ",", " ", 
                    "#"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}], 
               " ", "&"}], ",", 
              RowBox[{"BaseTemplateCore", "[", 
               RowBox[{
                RowBox[{"k", "[", "template1", "]"}], ",", 
                RowBox[{"r", "[", "template1", "]"}]}], "]"}]}], "]"}]}], 
           "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"templateNegado", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"BuildTemplate", "[", 
          RowBox[{
           RowBox[{"k", "[", "template1", "]"}], ",", 
           RowBox[{"r", "[", "template1", "]"}], ",", " ", "#", ",", " ", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"DeleteDuplicates", "[", " ", 
              RowBox[{"Flatten", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"postExpansionFn", "[", "template1", "]"}], ",", 
                 "FilterNotAllowed"}], "}"}], "]"}], "]"}], ",", " ", 
             RowBox[{
              RowBox[{"#", " ", "=!=", " ", "IdentityFn"}], " ", "&"}]}], 
            "]"}]}], "]"}], " ", "&"}], " ", "/@", " ", "coreList"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"TemplateIntersection", "[", 
         RowBox[{"template1", ",", "#"}], "]"}], " ", "&"}], " ", "/@", " ", 
       "templateNegado"}]}]}], "\[IndentingNewLine]", " ", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7213119521410832`*^9, 3.7213119938172026`*^9}, {
   3.7213122216011415`*^9, 3.721312232926076*^9}, {3.7213122639891276`*^9, 
   3.7213123988990326`*^9}, {3.72131248719991*^9, 3.721312512758512*^9}, {
   3.7213125451480536`*^9, 3.7213125609132757`*^9}, {3.721312591150812*^9, 
   3.7213126548330717`*^9}, {3.721312970879241*^9, 3.7213130648785405`*^9}, {
   3.7213131063512897`*^9, 3.7213131694686213`*^9}, {3.721313225815222*^9, 
   3.721313266253688*^9}, {3.7213133128667383`*^9, 3.721313383414012*^9}, {
   3.721313513784728*^9, 3.721313624247341*^9}, {3.721313764184534*^9, 
   3.7213138743954067`*^9}, {3.721314075610896*^9, 3.721314206837831*^9}, {
   3.7213142369641485`*^9, 3.721314241136036*^9}, {3.721314396246498*^9, 
   3.7213145262025986`*^9}, {3.7213145839978504`*^9, 3.721314859048499*^9}, {
   3.721314939376568*^9, 3.7213149818395433`*^9}, 3.7213150244585876`*^9, {
   3.721315081378319*^9, 3.7213151340839596`*^9}, {3.7213151824944897`*^9, 
   3.7213152813810816`*^9}, {3.7213161698899713`*^9, 3.721316236314162*^9}, {
   3.7213168859358363`*^9, 3.7213168865550213`*^9}, 3.7213188353268776`*^9, {
   3.721318866275879*^9, 3.7213188808826575`*^9}, {3.7213192685690656`*^9, 
   3.721319296783377*^9}, {3.7213193634076195`*^9, 3.721319452148559*^9}, 
   3.721319537944765*^9, {3.7213220167123795`*^9, 3.7213220483938336`*^9}, {
   3.7213220985621223`*^9, 3.7213221712416506`*^9}, {3.721322244817705*^9, 
   3.7213222454583535`*^9}, {3.7213224011274004`*^9, 
   3.7213224779976263`*^9}, {3.7213225203779593`*^9, 3.721322553109516*^9}, {
   3.7213393962453184`*^9, 3.7213394040063267`*^9}, {3.721339461590233*^9, 
   3.721339510117764*^9}, {3.7213395943265843`*^9, 3.721339594969751*^9}, {
   3.721339675018496*^9, 3.7213397055233765`*^9}, {3.721339747112155*^9, 
   3.7213397861932697`*^9}, {3.721339821699444*^9, 3.7213398494336157`*^9}, {
   3.7213399235229163`*^9, 3.7213400184724855`*^9}, {3.7213402364539075`*^9, 
   3.721340252081952*^9}, 3.7213404581702857`*^9, {3.721340539686388*^9, 
   3.7213405402785425`*^9}, {3.7213405939534063`*^9, 3.7213406693207073`*^9}, 
   3.7213407490958586`*^9, {3.721340942558793*^9, 3.7213410142452097`*^9}, {
   3.72134112284529*^9, 3.721341128876816*^9}, {3.721341208755462*^9, 
   3.7213412295520935`*^9}, {3.721341656635338*^9, 3.721341657238948*^9}, {
   3.7213451890129395`*^9, 3.7213452163150067`*^9}, {3.721345482646339*^9, 
   3.7213454870405025`*^9}, {3.721345528561221*^9, 3.72134553610419*^9}, {
   3.72134558258738*^9, 3.721345643134959*^9}, {3.72134583747534*^9, 
   3.7213458863376026`*^9}, {3.7213465366423945`*^9, 
   3.7213465432837853`*^9}, {3.721420794552812*^9, 3.7214208222770014`*^9}, {
   3.721420855216527*^9, 3.72142087388033*^9}, {3.7214209040610123`*^9, 
   3.721420910614278*^9}, 3.7214209482187557`*^9, {3.721421093744446*^9, 
   3.721421183835748*^9}, {3.721421219513997*^9, 3.721421222255684*^9}, {
   3.7214212885998507`*^9, 3.7214213404782777`*^9}, {3.7214213767506914`*^9, 
   3.7214213975910854`*^9}, 3.7214220652419643`*^9, {3.721423573470001*^9, 
   3.721423593980487*^9}, 3.721423648579617*^9, 3.721424070232253*^9, {
   3.7214270802767177`*^9, 3.721427094530414*^9}, 3.721427213914116*^9, {
   3.721427471842347*^9, 3.721427487115961*^9}, 3.721507918183943*^9, 
   3.721508866344548*^9, 3.7215090354061437`*^9, 3.7215116831308827`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ComplementaryTest", "[", 
  RowBox[{"BuildTemplate", "[", 
   RowBox[{"2", ",", " ", "0.5", ",", " ", 
    RowBox[{"{", 
     RowBox[{"x3", ",", 
      RowBox[{"x3", " ", "+", " ", "1"}], ",", "x1", ",", "x0"}], "}"}], ",", 
    " ", "FilterOutOfRange"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7213160700531034`*^9, 3.721316073005895*^9}, {
  3.721426707659791*^9, 3.721426715188329*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"x2", "\[Equal]", 
     RowBox[{
      RowBox[{"-", "0.1`"}], "+", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "0.9`"}], "+", "x3"}], ",", "2"}], "]"}]}]}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{"x2", "\[Equal]", 
     RowBox[{"Mod", "[", 
      RowBox[{
       RowBox[{"2", "+", "x3"}], ",", "2"}], "]"}]}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.721426715688301*^9, 3.72142706433893*^9, {3.721427491658597*^9, 
   3.721427498182082*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{"OperacaoDiferenca", "[", 
   RowBox[{
    RowBox[{"BuildTemplate", "[", 
     RowBox[{"2", ",", " ", "0.5", ",", " ", 
      RowBox[{"{", 
       RowBox[{"x3", ",", 
        RowBox[{"x3", " ", "+", " ", "1"}], ",", "x1", ",", "x0"}], "}"}], 
      ",", " ", "FilterOutOfRange"}], "]"}], ",", " ", 
    RowBox[{"BuildTemplate", "[", 
     RowBox[{"2", ",", " ", "0.5", ",", " ", 
      RowBox[{"{", 
       RowBox[{"x3", ",", "x2", ",", 
        RowBox[{"x3", " ", "+", " ", "1"}], ",", 
        RowBox[{"x3", " ", "+", " ", "1"}]}], "}"}]}], "]"}]}], "]"}], " ", 
  RowBox[{"(*", "  ", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"x", "-", "k"}], ")"}], "+", "0.1"}], ")"}], " ", "%", " ", 
     "k"}], "-", "0.1"}], "  ", "*)"}]}]], "Input",
 CellChangeTimes->{
  3.7213169567871985`*^9, {3.721317085261422*^9, 3.721317099088028*^9}, {
   3.72131899415899*^9, 3.7213189999114532`*^9}, {3.7213395212826796`*^9, 
   3.7213395377359385`*^9}, {3.721341239735741*^9, 3.721341249411954*^9}, {
   3.7213413319785013`*^9, 3.7213413339368258`*^9}, {3.7213416876341085`*^9, 
   3.721341699099758*^9}, {3.7213424192668743`*^9, 3.7213424536987696`*^9}, {
   3.721342617417446*^9, 3.7213426224927597`*^9}, {3.7213442415806665`*^9, 
   3.7213443266176753`*^9}, {3.7213443656367736`*^9, 
   3.7213444042376347`*^9}, {3.721344446616602*^9, 3.721344550964605*^9}, {
   3.7213446063059063`*^9, 3.721344634278171*^9}, {3.721420717593672*^9, 
   3.7214207297568197`*^9}, {3.7214220780703125`*^9, 3.721422088532996*^9}, {
   3.721422122527792*^9, 3.7214221250184345`*^9}, {3.7214221623701296`*^9, 
   3.7214222014822536`*^9}, 3.7214235692348795`*^9, {3.7214266894175887`*^9, 
   3.7214266969108033`*^9}, 3.72142718844811*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"\[LeftAssociation]", 
    RowBox[{
     RowBox[{"\<\"k\"\>", "\[Rule]", "2"}], ",", 
     RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
     RowBox[{"\<\"core\"\>", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"y3", ",", 
        RowBox[{"1", "+", "y3"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "1.`"}], " ", 
          RowBox[{"Floor", "[", 
           RowBox[{"1.`*^-12", "+", 
            FractionBox["0.1`", 
             RowBox[{"Abs", "[", 
              RowBox[{"1.1`", "\[VeryThinSpace]", "+", "y3", "-", 
               RowBox[{"1.`", " ", 
                RowBox[{"Mod", "[", 
                 RowBox[{
                  RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", 
                  "2.`"}], "]"}]}]}], "]"}]]}], "]"}]}], "+", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", "2.`"}], 
          "]"}], "-", 
         RowBox[{"1.`", " ", 
          RowBox[{"Floor", "[", 
           RowBox[{"1.`*^-12", "+", 
            FractionBox["0.1`", 
             RowBox[{"Abs", "[", 
              RowBox[{"1.1`", "\[VeryThinSpace]", "+", "y3", "-", 
               RowBox[{"1.`", " ", 
                RowBox[{"Mod", "[", 
                 RowBox[{
                  RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", 
                  "2.`"}], "]"}]}]}], "]"}]]}], "]"}], " ", 
          RowBox[{"Mod", "[", 
           RowBox[{
            RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", "2.`"}], 
           "]"}]}]}], ",", "x0"}], "}"}]}], ",", 
     RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", "FilterOutOfRange"}]}], 
    "\[RightAssociation]"}], ",", 
   RowBox[{"\[LeftAssociation]", 
    RowBox[{
     RowBox[{"\<\"k\"\>", "\[Rule]", "2"}], ",", 
     RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
     RowBox[{"\<\"core\"\>", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"y3", ",", 
        RowBox[{"1", "+", "y3"}], ",", "x1", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "1.`"}], " ", 
          RowBox[{"Floor", "[", 
           RowBox[{"1.`*^-12", "+", 
            FractionBox["0.1`", 
             RowBox[{"Abs", "[", 
              RowBox[{"1.1`", "\[VeryThinSpace]", "+", "y3", "-", 
               RowBox[{"1.`", " ", 
                RowBox[{"Mod", "[", 
                 RowBox[{
                  RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", 
                  "2.`"}], "]"}]}]}], "]"}]]}], "]"}]}], "+", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", "2.`"}], 
          "]"}], "-", 
         RowBox[{"1.`", " ", 
          RowBox[{"Floor", "[", 
           RowBox[{"1.`*^-12", "+", 
            FractionBox["0.1`", 
             RowBox[{"Abs", "[", 
              RowBox[{"1.1`", "\[VeryThinSpace]", "+", "y3", "-", 
               RowBox[{"1.`", " ", 
                RowBox[{"Mod", "[", 
                 RowBox[{
                  RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", 
                  "2.`"}], "]"}]}]}], "]"}]]}], "]"}], " ", 
          RowBox[{"Mod", "[", 
           RowBox[{
            RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", "2.`"}], 
           "]"}]}]}]}], "}"}]}], ",", 
     RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", "FilterOutOfRange"}]}], 
    "\[RightAssociation]"}], ",", 
   RowBox[{"\[LeftAssociation]", 
    RowBox[{
     RowBox[{"\<\"k\"\>", "\[Rule]", "2"}], ",", 
     RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
     RowBox[{"\<\"core\"\>", "\[Rule]", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", "FilterOutOfRange"}]}], 
    "\[RightAssociation]"}], ",", 
   RowBox[{"\[LeftAssociation]", 
    RowBox[{
     RowBox[{"\<\"k\"\>", "\[Rule]", "2"}], ",", 
     RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
     RowBox[{"\<\"core\"\>", "\[Rule]", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", "FilterOutOfRange"}]}], 
    "\[RightAssociation]"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.7214207300458803`*^9, 3.721420919696372*^9, 3.7214209510234804`*^9, {
   3.721421113356494*^9, 3.7214211247774596`*^9}, 3.7214211879257936`*^9, 
   3.7214212251394243`*^9, 3.721421343925181*^9, 3.721421400402785*^9, {
   3.7214220668683863`*^9, 3.72142208899411*^9}, 3.72142212577164*^9, {
   3.7214221646116953`*^9, 3.7214221761516695`*^9}, {3.721423569907051*^9, 
   3.721423596430119*^9}, 3.721423883638958*^9, 3.721424072158761*^9, {
   3.721427075563918*^9, 3.721427097592907*^9}, 3.7214272163506393`*^9, 
   3.7214274994789596`*^9, 3.7214604258285513`*^9, 3.721460712013103*^9, 
   3.7214608218948464`*^9, 3.7214609056815724`*^9, 3.7214612000963545`*^9, 
   3.72150741015639*^9, 3.721508263219019*^9, 3.721509020757172*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ListasIguais", "[", 
   RowBox[{"lista1_List", ",", " ", "lista2_List"}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Sort", "[", "lista1", "]"}], " ", "===", " ", 
   RowBox[{"Sort", "[", "lista2", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7213423691269083`*^9, 3.7213423912486334`*^9}, {
  3.721342650056893*^9, 3.721342701491232*^9}, {3.7213433056726265`*^9, 
  3.7213433212846947`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ListasIguais", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "2"}], "}"}]}], "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "1"}], "}"}]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.721342703461734*^9, 3.72134271936383*^9}, {
  3.7213433262479787`*^9, 3.721343349250932*^9}}],

Cell[BoxData["False"], "Output",
 CellChangeTimes->{{3.7213427156738873`*^9, 3.7213427198829794`*^9}, {
   3.721343323747304*^9, 3.7213433500311193`*^9}, 3.7213467361932507`*^9, 
   3.721461442222041*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ListasDiferenca", "[", 
   RowBox[{"lista1_List", ",", " ", "lista2_List"}], "]"}], " ", ":=", " ", 
  RowBox[{"Select", "[", 
   RowBox[{"lista1", ",", 
    RowBox[{
     RowBox[{"ContainsNone", "[", 
      RowBox[{"lista2", ",", " ", 
       RowBox[{"{", "#", "}"}]}], "]"}], " ", "&"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7213435193834763`*^9, 3.7213436950307407`*^9}, {
   3.7213440159182568`*^9, 3.7213440565397635`*^9}, {3.721344113969632*^9, 
   3.7213441226698923`*^9}, 3.721344703361226*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ListasDiferenca", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "2"}], "}"}]}], "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "1"}], "}"}]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{3.7213437048549805`*^9, 3.7213447076253242`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
   "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", 
    ",", "2"}], "}"}], "}"}]], "Output",
 CellChangeTimes->{
  3.7213437051674733`*^9, {3.7213440596475935`*^9, 3.7213440720947742`*^9}, 
   3.721344124942453*^9, 3.721344708077449*^9, 3.7213467449873486`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ExpandirOperacaoDiferenca", "[", 
   RowBox[{"template1_Association", ",", "template2_Association"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"DeleteDuplicates", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"ExpandTemplate", "[", "#", "]"}], " ", "&"}], " ", "/@", " ", 
       RowBox[{"OperacaoDiferenca", "[", 
        RowBox[{"template1", ",", " ", "template2"}], "]"}]}], ")"}], ",", 
     " ", "1"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7213438148462*^9, 3.7213438202836018`*^9}, {
   3.7213438528470507`*^9, 3.721343863911915*^9}, {3.7213439222240143`*^9, 
   3.7213439867186947`*^9}, {3.721344142312975*^9, 3.7213441684287205`*^9}, 
   3.721344222617734*^9, {3.7213446473085165`*^9, 3.7213446741746664`*^9}, {
   3.721344955049387*^9, 3.721344958384242*^9}, {3.7213451024265037`*^9, 
   3.721345115174814*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"TestarOperacaoDiferenca", "[", 
   RowBox[{"template1_Association", ",", "template2_Association"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"ListasIguais", "[", 
   RowBox[{
    RowBox[{"ListasDiferenca", "[", 
     RowBox[{
      RowBox[{"ExpandTemplate", "[", "template1", "]"}], ",", " ", 
      RowBox[{"ExpandTemplate", "[", "template2", "]"}]}], "]"}], ",", " ", 
    RowBox[{"ExpandirOperacaoDiferenca", "[", 
     RowBox[{"template1", ",", " ", "template2"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7213446804493046`*^9, 3.721344693210619*^9}, {
  3.7213447236735044`*^9, 3.721344788961403*^9}}],

Cell[BoxData[
 RowBox[{"TestarOperacaoDiferenca", "[", 
  RowBox[{
   RowBox[{"ColorBlindTemplate", "[", 
    RowBox[{"2", ",", " ", "0.5"}], "]"}], ",", " ", 
   RowBox[{"StateConservingTemplate", "[", 
    RowBox[{"2", ",", " ", "0.5"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7213447911049433`*^9, 3.72134480545467*^9}, {
  3.721344968948984*^9, 3.721344978151353*^9}, {3.72134593360058*^9, 
  3.7213459834608545`*^9}, {3.721346069190419*^9, 3.7213460734404297`*^9}, {
  3.7213465725759115`*^9, 3.7213465991507187`*^9}, {3.7215982666416283`*^9, 
  3.7215982841369004`*^9}, {3.721598561060278*^9, 3.7215985637417297`*^9}, {
  3.7215995490436563`*^9, 3.721599579961689*^9}}],

Cell[BoxData["True"], "Input",
 CellChangeTimes->{{3.7215995816631026`*^9, 3.721599582240255*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"TestarOperacaoDiferenca", "[", 
   RowBox[{
    RowBox[{"BuildTemplate", "[", 
     RowBox[{"2", ",", " ", "0.5", ",", " ", 
      RowBox[{"{", 
       RowBox[{"x3", ",", 
        RowBox[{"x3", " ", "+", " ", "1"}], ",", "x1", ",", "x0"}], "}"}], 
      ",", " ", 
      RowBox[{"{", 
       RowBox[{"FilterOutOfRange", ",", " ", "FilterOutOfRangeB"}], "}"}]}], 
     "]"}], ",", " ", 
    RowBox[{"BuildTemplate", "[", 
     RowBox[{"2", ",", " ", "0.5", ",", " ", 
      RowBox[{"{", 
       RowBox[{"x3", ",", "x2", ",", 
        RowBox[{"x3", " ", "+", " ", "1"}], ",", 
        RowBox[{"x3", " ", "+", " ", "1"}]}], "}"}]}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7215995835195837`*^9, 3.721599584529849*^9}, {
  3.7215996159430256`*^9, 3.7215997304247055`*^9}}],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{
  3.72159958754963*^9, 3.7215996228027782`*^9, {3.7215996712303443`*^9, 
   3.721599733272462*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ExpandTemplate", "[", " ", 
  RowBox[{"StateConservingTemplate", "[", 
   RowBox[{"3", ",", " ", "0.5"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7215985177211723`*^9, 3.721598550886916*^9}, {
  3.7215985914028773`*^9, 3.721598631324953*^9}, {3.7215987520199966`*^9, 
  3.721598840453153*^9}, {3.721598933252861*^9, 3.721598938006078*^9}, {
  3.721599036219564*^9, 3.7215990403516364`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "2", ",", "2", ",", "2", ",", "1", ",", "1", ",", "1", ",", "0", ",", "0",
      ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2", ",", "1", ",", "1", ",", "2", ",", "1", ",", "1", ",", "1", ",", "0",
      ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2", ",", "2", ",", "1", ",", "1", ",", "1", ",", "0", ",", "1", ",", "1",
      ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2", ",", "1", ",", "0", ",", "2", ",", "1", ",", "0", ",", "2", ",", "1",
      ",", "0"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.721598921341197*^9, {3.7215990257938557`*^9, 3.72159904195605*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7215986526009054`*^9, 3.721598656722518*^9}, 
   3.721598750396155*^9}],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"\<\"k\"\>", "\[Rule]", "3"}], ",", 
   RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
   RowBox[{"\<\"core\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{"2", ",", 
        RowBox[{
         RowBox[{"0", "\[LessEqual]", "y3", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x8", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y8", "<", "3"}]}]}], "]"}], ",", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{"2", ",", 
        RowBox[{
         RowBox[{"0", "\[LessEqual]", "y3", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x8", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y8", "<", "3"}]}]}], "]"}], ",", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{"2", ",", 
        RowBox[{
         RowBox[{"0", "\[LessEqual]", "y3", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x8", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y8", "<", "3"}]}]}], "]"}], ",", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{"1", ",", 
        RowBox[{
         RowBox[{"0", "\[LessEqual]", "y3", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x8", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y8", "<", "3"}]}]}], "]"}], ",", "1", 
      ",", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{"1", ",", 
        RowBox[{
         RowBox[{"0", "\[LessEqual]", "y3", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x8", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y8", "<", "3"}]}]}], "]"}], ",", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{"0", ",", 
        RowBox[{
         RowBox[{"0", "\[LessEqual]", "y3", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x8", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y8", "<", "3"}]}]}], "]"}], ",", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{"0", ",", 
        RowBox[{
         RowBox[{"0", "\[LessEqual]", "y3", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x8", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y8", "<", "3"}]}]}], "]"}], ",", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{"0", ",", 
        RowBox[{
         RowBox[{"0", "\[LessEqual]", "y3", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y4", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y5", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y6", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y7", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x8", "<", "3"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "y8", "<", "3"}]}]}], "]"}]}], "}"}]}], 
   ",", 
   RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"FilterNotAllowed", ",", "ModK"}], "}"}]}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{3.721598658304499*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Sort", "[", 
  RowBox[{"ExpandirOperacaoDiferenca", "[", " ", 
   RowBox[{
    RowBox[{"ColorBlindTemplate", "[", 
     RowBox[{"3", ",", " ", "0.5"}], "]"}], ",", " ", 
    RowBox[{"StateConservingTemplate", "[", 
     RowBox[{"3", ",", " ", "0.5"}], "]"}]}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7213460782817497`*^9, 3.721346129153633*^9}, {
   3.7213461849545126`*^9, 3.72134618556564*^9}, {3.721346380725591*^9, 
   3.7213464351312785`*^9}, 3.7213465100685873`*^9, 3.721346569599496*^9, {
   3.7213466041037264`*^9, 3.721346608850479*^9}, {3.721346862118681*^9, 
   3.721346863509308*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "2", ",", "0", ",", "1", ",", "0", ",", "1", ",", "2", ",", "1", ",", "2",
      ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2", ",", "1", ",", "0", ",", "2", ",", "1", ",", "0", ",", "2", ",", "1",
      ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2", ",", "2", ",", "2", ",", "1", ",", "1", ",", "1", ",", "0", ",", "0",
      ",", "0"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.7213460631988907`*^9, 3.7213460951939583`*^9}, 
   3.7213461359052734`*^9, 3.7213461860287695`*^9, {3.7213463775314703`*^9, 
   3.721346394811767*^9}, {3.7213464292668896`*^9, 3.721346435678153*^9}, 
   3.7213464666849685`*^9, 3.7213465105217257`*^9, {3.7213465469396315`*^9, 
   3.7213465702657924`*^9}, {3.7213466046506157`*^9, 3.721346609381729*^9}, 
   3.7213467507249618`*^9, 3.7213467952532606`*^9, 3.7213468639624176`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ListasDiferenca", "[", 
  RowBox[{
   RowBox[{"ExpandTemplate", "[", 
    RowBox[{"ColorBlindTemplate", "[", 
     RowBox[{"3", ",", " ", "0.5"}], "]"}], "]"}], ",", " ", 
   RowBox[{"ExpandTemplate", "[", 
    RowBox[{"StateConservingTemplate", "[", 
     RowBox[{"3", ",", " ", "0.5"}], "]"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.721346238230925*^9, 3.721346297677369*^9}, {
  3.7213466290774145`*^9, 3.7213466417689147`*^9}, {3.7213467913810053`*^9, 
  3.7213467922845163`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
   "2", ",", "0", ",", "1", ",", "0", ",", "1", ",", "2", ",", "1", ",", "2", 
    ",", "0"}], "}"}], "}"}]], "Output",
 CellChangeTimes->{{3.721346232059022*^9, 3.7213462979898677`*^9}, 
   3.721346642940775*^9, {3.7213467002335415`*^9, 3.7213467104458117`*^9}, 
   3.7213467531719875`*^9, {3.7213467928001156`*^9, 3.721346797115503*^9}, 
   3.7213468750912576`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ColorBlindTemplate", "[", 
  RowBox[{"3", ",", " ", "0.5"}], "]"}]], "Input",
 CellChangeTimes->{{3.7213466763289413`*^9, 3.721346697842913*^9}, {
  3.721346785005748*^9, 3.721346824538393*^9}, {3.721347047266322*^9, 
  3.7213470515944595`*^9}}],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"\<\"k\"\>", "\[Rule]", "3"}], ",", 
   RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
   RowBox[{"\<\"core\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"2", ",", 
      RowBox[{"2", "-", "x1"}], ",", 
      RowBox[{"2", "-", 
       RowBox[{"2", " ", "x1"}]}], ",", 
      RowBox[{"1", "-", 
       RowBox[{"2", " ", "x1"}]}], ",", "1", ",", 
      RowBox[{"1", "+", 
       RowBox[{"2", " ", "x1"}]}], ",", 
      RowBox[{"2", " ", "x1"}], ",", "x1", ",", "0"}], "}"}]}], ",", 
   RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"FilterNotAllowed", ",", "ModK"}], "}"}]}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{3.7213470519538164`*^9, 3.721348285742432*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"StateConservingTemplate", "[", 
  RowBox[{"3", ",", " ", "0.5"}], "]"}]], "Input",
 CellChangeTimes->{{3.721346816723083*^9, 3.7213468283205976`*^9}, {
  3.721346912315662*^9, 3.7213469138312902`*^9}}],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"\<\"k\"\>", "\[Rule]", "3"}], ",", 
   RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
   RowBox[{"\<\"core\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"2", ",", 
      RowBox[{"2", "+", "x1", "-", "x2"}], ",", 
      RowBox[{"2", "-", "x2"}], ",", 
      RowBox[{"1", "-", "x1", "+", "x2"}], ",", "1", ",", 
      RowBox[{"1", "-", "x1"}], ",", "x2", ",", "x1", ",", "0"}], "}"}]}], 
   ",", 
   RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", "FilterOutOfRange"}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{{3.721346817207432*^9, 3.7213468288518353`*^9}, 
   3.721346914471901*^9, 3.721511651505789*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"OperacaoDiferenca", "[", " ", 
   RowBox[{
    RowBox[{"ColorBlindTemplate", "[", 
     RowBox[{"2", ",", " ", "0.5"}], "]"}], ",", " ", 
    RowBox[{"StateConservingTemplate", "[", 
     RowBox[{"2", ",", " ", "0.5"}], "]"}]}], "]"}], "[", 
  RowBox[{"[", "2", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7213469806828094`*^9, 3.7213470290777225`*^9}, {
  3.721511628919762*^9, 3.7215116610013065`*^9}}],

Cell[BoxData[
 TemplateBox[{
  "ReplaceAll","reps",
   "\"\\!\\(\\*RowBox[{\\\"{\\\", RowBox[{RowBox[{RowBox[{\\\"1\\\", \
\\\"-\\\", \\\"x0\\\"}], \\\"\[Equal]\\\", \\\"y3\\\"}], \\\",\\\", \
RowBox[{RowBox[{\\\"1\\\", \\\"-\\\", \\\"x1\\\"}], \\\"\[Equal]\\\", \
RowBox[{RowBox[{\\\"-\\\", \\\"1\\\"}], \\\"+\\\", RowBox[{RowBox[{\\\"(\\\", \
RowBox[{\\\"1\\\", \\\"-\\\", RowBox[{\\\"Floor\\\", \\\"[\\\", \
RowBox[{\\\"Plus\\\", \\\"[\\\", RowBox[{\\\"\[LeftSkeleton]\\\", \\\"2\\\", \
\\\"\[RightSkeleton]\\\"}], \\\"]\\\"}], \\\"]\\\"}]}], \\\")\\\"}], \\\" \
\\\", RowBox[{\\\"(\\\", RowBox[{\\\"1\\\", \\\"+\\\", RowBox[{\\\"Mod\\\", \
\\\"[\\\", RowBox[{RowBox[{\\\"1\\\", \\\"+\\\", RowBox[{\\\"Times\\\", \\\"[\
\\\", RowBox[{\\\"\[LeftSkeleton]\\\", \\\"2\\\", \\\"\[RightSkeleton]\\\"}], \
\\\"]\\\"}]}], \\\",\\\", \\\"2\\\"}], \\\"]\\\"}]}], \\\")\\\"}]}]}]}], \
\\\",\\\", RowBox[{\\\"x1\\\", \\\"\[Equal]\\\", \\\"y1\\\"}], \\\",\\\", \
RowBox[{\\\"x0\\\", \\\"\[Equal]\\\", \\\"y0\\\"}]}], \\\"}\\\"}]\\) is \
neither a list of replacement rules nor a valid dispatch table, and so cannot \
be used for replacing.\"",2,32,24,29442681611948556047,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.721461205641181*^9, 3.7215074213090873`*^9, 3.7215116033820543`*^9, {
   3.721511634068177*^9, 3.7215116674965754`*^9}}],

Cell[BoxData[
 TemplateBox[{
  "ReplaceAll","reps",
   "\"\\!\\(\\*RowBox[{\\\"{\\\", RowBox[{RowBox[{RowBox[{\\\"1\\\", \
\\\"-\\\", \\\"x0\\\"}], \\\"\[Equal]\\\", \\\"y3\\\"}], \\\",\\\", \
RowBox[{RowBox[{\\\"1\\\", \\\"-\\\", \\\"x1\\\"}], \\\"\[Equal]\\\", \
RowBox[{\\\"Mod\\\", \\\"[\\\", RowBox[{RowBox[{\\\"2\\\", \\\"-\\\", \
\\\"y1\\\"}], \\\",\\\", \\\"2\\\"}], \\\"]\\\"}]}], \\\",\\\", \
RowBox[{\\\"x1\\\", \\\"\[Equal]\\\", \\\"y1\\\"}], \\\",\\\", RowBox[{\\\"x0\
\\\", \\\"\[Equal]\\\", \\\"y0\\\"}]}], \\\"}\\\"}]\\) is neither a list of \
replacement rules nor a valid dispatch table, and so cannot be used for \
replacing.\"",2,32,25,29442681611948556047,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.721461205641181*^9, 3.7215074213090873`*^9, 3.7215116033820543`*^9, {
   3.721511634068177*^9, 3.721511667527825*^9}}],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"\<\"k\"\>", "\[Rule]", "2"}], ",", 
   RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
   RowBox[{"\<\"core\"\>", "\[Rule]", 
    RowBox[{"{", "}"}]}], ",", 
   RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"FilterNotAllowed", ",", "ModK"}], "}"}]}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{
  3.721346888500827*^9, {3.7213469901318135`*^9, 3.721347029437087*^9}, 
   3.7213472241268916`*^9, 3.7213482475655513`*^9, 3.721461205688059*^9, 
   3.721507421355979*^9, 3.7215116034289293`*^9, {3.7215116340994434`*^9, 
   3.721511667527825*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ExpandTemplate", "[", 
  RowBox[{"BuildTemplate", "[", 
   RowBox[{"3", ",", " ", "0.5", ",", " ", 
    RowBox[{"{", 
     RowBox[{"2", " ", ",", 
      RowBox[{
       RowBox[{"2", "-", "x1"}], " ", "\[NotElement]", " ", 
       RowBox[{"{", "0", "}"}]}], ",", 
      RowBox[{"2", "-", 
       RowBox[{"2", " ", "x1"}]}], ",", 
      RowBox[{"1", "-", 
       RowBox[{"2", " ", "x1"}]}], ",", "1", ",", 
      RowBox[{"1", "+", 
       RowBox[{"2", " ", "x1"}]}], ",", 
      RowBox[{"2", " ", "x1"}], ",", "x1", ",", "0"}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"FilterNotElement", ",", " ", "ModK"}], "}"}]}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.7213473440993023`*^9, 3.7213474694550037`*^9}, {
   3.7213481547885284`*^9, 3.7213481700974903`*^9}, {3.721348273426259*^9, 
   3.7213484258566847`*^9}, {3.7213485419437284`*^9, 
   3.7213485771478662`*^9}, {3.72134863060769*^9, 3.721348637830573*^9}, {
   3.7213488298122597`*^9, 3.7213488316987486`*^9}, 3.72134886601663*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"FilterNotElement", "[", 
    RowBox[{
     RowBox[{"\[LeftAssociation]", 
      RowBox[{
       RowBox[{"\<\"k\"\>", "\[Rule]", "3"}], ",", 
       RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
       RowBox[{"\<\"core\"\>", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"2", ",", 
          RowBox[{
           RowBox[{"2", "-", "x1"}], "\[NotElement]", 
           RowBox[{"{", "0", "}"}]}], ",", 
          RowBox[{"2", "-", 
           RowBox[{"2", " ", "x1"}]}], ",", 
          RowBox[{"1", "-", 
           RowBox[{"2", " ", "x1"}]}], ",", "1", ",", 
          RowBox[{"1", "+", 
           RowBox[{"2", " ", "x1"}]}], ",", 
          RowBox[{"2", " ", "x1"}], ",", "x1", ",", "0"}], "}"}]}], ",", 
       RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"FilterNotElement", ",", "ModK"}], "}"}]}]}], 
      "\[RightAssociation]"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", 
       RowBox[{"Mod", "[", 
        RowBox[{
         RowBox[{"2", "\[NotElement]", 
          RowBox[{"{", "0", "}"}]}], ",", "3"}], "]"}], ",", "2", ",", "1", 
       ",", "1", ",", "1", ",", "0", ",", "0", ",", "0"}], "}"}]}], "]"}], 
   ",", 
   RowBox[{"FilterNotElement", "[", 
    RowBox[{
     RowBox[{"\[LeftAssociation]", 
      RowBox[{
       RowBox[{"\<\"k\"\>", "\[Rule]", "3"}], ",", 
       RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
       RowBox[{"\<\"core\"\>", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"2", ",", 
          RowBox[{
           RowBox[{"2", "-", "x1"}], "\[NotElement]", 
           RowBox[{"{", "0", "}"}]}], ",", 
          RowBox[{"2", "-", 
           RowBox[{"2", " ", "x1"}]}], ",", 
          RowBox[{"1", "-", 
           RowBox[{"2", " ", "x1"}]}], ",", "1", ",", 
          RowBox[{"1", "+", 
           RowBox[{"2", " ", "x1"}]}], ",", 
          RowBox[{"2", " ", "x1"}], ",", "x1", ",", "0"}], "}"}]}], ",", 
       RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"FilterNotElement", ",", "ModK"}], "}"}]}]}], 
      "\[RightAssociation]"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", 
       RowBox[{"Mod", "[", 
        RowBox[{
         RowBox[{"1", "\[NotElement]", 
          RowBox[{"{", "0", "}"}]}], ",", "3"}], "]"}], ",", "0", ",", "2", 
       ",", "1", ",", "0", ",", "2", ",", "1", ",", "0"}], "}"}]}], "]"}], 
   ",", 
   RowBox[{"FilterNotElement", "[", 
    RowBox[{
     RowBox[{"\[LeftAssociation]", 
      RowBox[{
       RowBox[{"\<\"k\"\>", "\[Rule]", "3"}], ",", 
       RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
       RowBox[{"\<\"core\"\>", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"2", ",", 
          RowBox[{
           RowBox[{"2", "-", "x1"}], "\[NotElement]", 
           RowBox[{"{", "0", "}"}]}], ",", 
          RowBox[{"2", "-", 
           RowBox[{"2", " ", "x1"}]}], ",", 
          RowBox[{"1", "-", 
           RowBox[{"2", " ", "x1"}]}], ",", "1", ",", 
          RowBox[{"1", "+", 
           RowBox[{"2", " ", "x1"}]}], ",", 
          RowBox[{"2", " ", "x1"}], ",", "x1", ",", "0"}], "}"}]}], ",", 
       RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"FilterNotElement", ",", "ModK"}], "}"}]}]}], 
      "\[RightAssociation]"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", 
       RowBox[{"Mod", "[", 
        RowBox[{
         RowBox[{"0", "\[NotElement]", 
          RowBox[{"{", "0", "}"}]}], ",", "3"}], "]"}], ",", "1", ",", "0", 
       ",", "1", ",", "2", ",", "1", ",", "2", ",", "0"}], "}"}]}], "]"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.721347378411807*^9, 3.721347427536189*^9}, {
   3.7213474644705873`*^9, 3.7213474701756983`*^9}, 3.7213481561368756`*^9, {
   3.721348202409862*^9, 3.7213482140048547`*^9}, {3.721348276108926*^9, 
   3.721348387056655*^9}, {3.7213484216856184`*^9, 3.721348426440847*^9}, {
   3.7213485324102736`*^9, 3.7213485783781586`*^9}, 3.7213486389078255`*^9, 
   3.7213488323458977`*^9, 3.721348866984854*^9, 3.721461215175969*^9}]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7213473815222335`*^9, 3.7213473821628747`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FilterNotElement", "[", 
     RowBox[{"template_Association", ",", "expansion_List"}], "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"memberQsInHold", "=", 
        RowBox[{"Cases", "[", 
         RowBox[{"expansion", ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"value_", "\[NotElement]", "set_List"}], "\[Rule]", 
            RowBox[{"Hold", "[", 
             RowBox[{"MemberQ", "[", 
              RowBox[{"set", ",", "value"}], "]"}], "]"}]}], ")"}], ",", 
          "Infinity"}], "]"}]}], "}"}], ",", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"And", "@@", 
          RowBox[{"(", 
           RowBox[{"ReleaseHold", "/@", "memberQsInHold"}], ")"}]}], 
         "\[Equal]", "True"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", "##", ")"}], "&"}], "[", "]"}], ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "At", " ", "least", " ", "one", " ", "of", " ", "the", " ", 
           "expressions", " ", "is", " ", "invalid"}], ",", 
          RowBox[{
          "this", " ", "expansion", " ", "should", " ", "be", " ", 
           "filtered"}]}], "*)"}], 
        RowBox[{"expansion", "/.", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"value_", " ", "\[NotElement]", " ", "set_List"}], 
           "\[Rule]", "value"}], ")"}]}]}], "]"}]}], "]"}]}], ";"}], 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"All", " ", "expressions", " ", "are", " ", "valid"}], ",", 
    RowBox[{"this", " ", "expansion", " ", "is", " ", 
     RowBox[{"ok", "."}]}]}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.721348141274047*^9, 3.721348150505437*^9}, {
  3.721348194285777*^9, 3.721348210705011*^9}, {3.7213484818672075`*^9, 
  3.7213485498708076`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"OperacaoDiferenca", "[", 
   RowBox[{
    RowBox[{"BuildTemplate", "[", 
     RowBox[{"2", ",", " ", "0.5", ",", " ", 
      RowBox[{"{", 
       RowBox[{"x3", ",", 
        RowBox[{"x3", " ", "+", " ", "1"}], ",", "x1", ",", "x0"}], "}"}], 
      ",", " ", "FilterOutOfRange"}], "]"}], ",", " ", 
    RowBox[{"BuildTemplate", "[", 
     RowBox[{"2", ",", " ", "0.5", ",", " ", 
      RowBox[{"{", 
       RowBox[{"x3", ",", "x2", ",", 
        RowBox[{"x3", " ", "+", " ", "1"}], ",", 
        RowBox[{"x3", " ", "+", " ", "1"}]}], "}"}]}], "]"}]}], "]"}], " ", 
  RowBox[{"(*", "  ", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"x", "-", "k"}], ")"}], "+", "0.1"}], ")"}], " ", "%", " ", 
     "k"}], "-", "0.1"}], "  ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.7214275185050135`*^9, 3.721427536818675*^9}, {
  3.721427691117964*^9, 3.7214277179617915`*^9}, {3.721428002801049*^9, 
  3.721428003863553*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"\[LeftAssociation]", 
    RowBox[{
     RowBox[{"\<\"k\"\>", "\[Rule]", "2"}], ",", 
     RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
     RowBox[{"\<\"core\"\>", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"y3", ",", 
        RowBox[{"ConditionalExpression", "[", 
         RowBox[{
          RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", 
          RowBox[{
           RowBox[{"0", "\[LessEqual]", 
            RowBox[{"Re", "[", "y0", "]"}], "<", "2.`"}], "&&", 
           RowBox[{
            RowBox[{"Im", "[", "y0", "]"}], "\[Equal]", "0"}], "&&", 
           RowBox[{"0", "\[LessEqual]", "x2", "<", "2.`"}], "&&", 
           RowBox[{"1.`", "\[LessEqual]", "y3", "<", "2.`"}]}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"-", "1"}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"Floor", "[", 
             RowBox[{"1.`*^-12", "+", 
              FractionBox["1", 
               RowBox[{"10", " ", 
                RowBox[{"Abs", "[", 
                 RowBox[{"1.1`", "\[VeryThinSpace]", "+", "y3", "-", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"1", "+", "y3"}], ",", "2"}], "]"}]}], "]"}]}]]}],
              "]"}]}], ")"}], " ", 
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{"Mod", "[", 
             RowBox[{
              RowBox[{"1", "+", "y3"}], ",", "2"}], "]"}]}], ")"}]}]}], ",", 
        "y0"}], "}"}]}], ",", 
     RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", "FilterOutOfRange"}]}], 
    "\[RightAssociation]"}], ",", 
   RowBox[{"\[LeftAssociation]", 
    RowBox[{
     RowBox[{"\<\"k\"\>", "\[Rule]", "2"}], ",", 
     RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
     RowBox[{"\<\"core\"\>", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"y3", ",", 
        RowBox[{"ConditionalExpression", "[", 
         RowBox[{
          RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", 
          RowBox[{
           RowBox[{"0", "\[LessEqual]", 
            RowBox[{"Re", "[", "y1", "]"}], "<", "2.`"}], "&&", 
           RowBox[{
            RowBox[{"Im", "[", "y1", "]"}], "\[Equal]", "0"}], "&&", 
           RowBox[{"0", "\[LessEqual]", "x2", "<", "2.`"}], "&&", 
           RowBox[{"1.`", "\[LessEqual]", "y3", "<", "2.`"}]}]}], "]"}], ",", 
        "y1", ",", 
        RowBox[{
         RowBox[{"-", "1"}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"Floor", "[", 
             RowBox[{"1.`*^-12", "+", 
              FractionBox["1", 
               RowBox[{"10", " ", 
                RowBox[{"Abs", "[", 
                 RowBox[{"1.1`", "\[VeryThinSpace]", "+", "y3", "-", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"1", "+", "y3"}], ",", "2"}], "]"}]}], "]"}]}]]}],
              "]"}]}], ")"}], " ", 
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{"Mod", "[", 
             RowBox[{
              RowBox[{"1", "+", "y3"}], ",", "2"}], "]"}]}], ")"}]}]}]}], 
       "}"}]}], ",", 
     RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", "FilterOutOfRange"}]}], 
    "\[RightAssociation]"}], ",", 
   RowBox[{"\[LeftAssociation]", 
    RowBox[{
     RowBox[{"\<\"k\"\>", "\[Rule]", "2"}], ",", 
     RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
     RowBox[{"\<\"core\"\>", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ConditionalExpression", "[", 
         RowBox[{"x1", ",", 
          RowBox[{
           RowBox[{"0", "\[LessEqual]", 
            RowBox[{"Re", "[", "y0", "]"}], "<", "2"}], "&&", 
           RowBox[{
            RowBox[{"Im", "[", "y0", "]"}], "\[Equal]", "0"}], "&&", 
           RowBox[{"0", "\[LessEqual]", "x1", "<", "2"}], "&&", 
           RowBox[{"0", "\[LessEqual]", "x2", "<", "2"}]}]}], "]"}], ",", 
        RowBox[{"ConditionalExpression", "[", 
         RowBox[{
          RowBox[{"1", "+", "x1"}], ",", 
          RowBox[{
           RowBox[{"0", "\[LessEqual]", 
            RowBox[{"Re", "[", "y0", "]"}], "<", "2"}], "&&", 
           RowBox[{
            RowBox[{"Im", "[", "y0", "]"}], "\[Equal]", "0"}], "&&", 
           RowBox[{"0", "\[LessEqual]", "x1", "<", "2"}], "&&", 
           RowBox[{"0", "\[LessEqual]", "x2", "<", "2"}]}]}], "]"}], ",", 
        "x1", ",", 
        RowBox[{"ConditionalExpression", "[", 
         RowBox[{"y0", ",", 
          RowBox[{
           RowBox[{"0", "\[LessEqual]", 
            RowBox[{"Re", "[", "y0", "]"}], "<", "2"}], "&&", 
           RowBox[{
            RowBox[{"Im", "[", "y0", "]"}], "\[Equal]", "0"}], "&&", 
           RowBox[{"0", "\[LessEqual]", "x1", "<", "2"}], "&&", 
           RowBox[{"0", "\[LessEqual]", "x2", "<", "2"}]}]}], "]"}]}], 
       "}"}]}], ",", 
     RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", "FilterOutOfRange"}]}], 
    "\[RightAssociation]"}], ",", 
   RowBox[{"\[LeftAssociation]", 
    RowBox[{
     RowBox[{"\<\"k\"\>", "\[Rule]", "2"}], ",", 
     RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
     RowBox[{"\<\"core\"\>", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ConditionalExpression", "[", 
         RowBox[{"x0", ",", 
          RowBox[{
           RowBox[{"0", "\[LessEqual]", "x0", "<", "2"}], "&&", 
           RowBox[{"0", "\[LessEqual]", 
            RowBox[{"Re", "[", "y1", "]"}], "<", "2"}], "&&", 
           RowBox[{
            RowBox[{"Im", "[", "y1", "]"}], "\[Equal]", "0"}], "&&", 
           RowBox[{"0", "\[LessEqual]", "x2", "<", "2"}]}]}], "]"}], ",", 
        RowBox[{"ConditionalExpression", "[", 
         RowBox[{
          RowBox[{"1", "+", "x0"}], ",", 
          RowBox[{
           RowBox[{"0", "\[LessEqual]", "x0", "<", "2"}], "&&", 
           RowBox[{"0", "\[LessEqual]", 
            RowBox[{"Re", "[", "y1", "]"}], "<", "2"}], "&&", 
           RowBox[{
            RowBox[{"Im", "[", "y1", "]"}], "\[Equal]", "0"}], "&&", 
           RowBox[{"0", "\[LessEqual]", "x2", "<", "2"}]}]}], "]"}], ",", 
        "y1", ",", 
        RowBox[{"ConditionalExpression", "[", 
         RowBox[{
          RowBox[{"Mod", "[", 
           RowBox[{
            RowBox[{"2", "+", "x0"}], ",", "2"}], "]"}], ",", 
          RowBox[{
           RowBox[{"0", "\[LessEqual]", "x0", "<", "2"}], "&&", 
           RowBox[{"0", "\[LessEqual]", 
            RowBox[{"Re", "[", "y1", "]"}], "<", "2"}], "&&", 
           RowBox[{
            RowBox[{"Im", "[", "y1", "]"}], "\[Equal]", "0"}], "&&", 
           RowBox[{"0", "\[LessEqual]", "x2", "<", "2"}]}]}], "]"}]}], 
       "}"}]}], ",", 
     RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", "FilterOutOfRange"}]}], 
    "\[RightAssociation]"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.721427700867968*^9, 3.7214277193211555`*^9}, 
   3.7214280055970936`*^9, 3.721460845826675*^9, 3.7214612495739603`*^9, 
   3.7215074267075725`*^9, 3.7215083021846256`*^9, 3.7215083815692043`*^9, 
   3.721511230641879*^9, 3.721511269872359*^9, 3.721598127072859*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ExpandTemplate", "[", 
  RowBox[{"BuildTemplate", "[", 
   RowBox[{"2", ",", " ", "0.5", ",", " ", 
    RowBox[{"{", 
     RowBox[{"x3", ",", 
      RowBox[{"x3", " ", "+", " ", "1"}], ",", "x1", ",", "x0"}], "}"}], ",", 
    " ", "FilterOutOfRange"}], "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ExpandTemplate", "[", " ", 
  RowBox[{"BuildTemplate", "[", 
   RowBox[{"2", ",", " ", "0.5", ",", " ", 
    RowBox[{"{", 
     RowBox[{"x3", ",", "x2", ",", 
      RowBox[{"x3", " ", "+", " ", "1"}], ",", 
      RowBox[{"x3", " ", "+", " ", "1"}]}], "}"}]}], "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.7214275596610355`*^9, 3.7214275757405467`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "1", ",", "1"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.721427578350837*^9, {3.7215074311415043`*^9, 3.721507433637374*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "0", ",", "2", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "2", ",", "2"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.721427578350837*^9, {3.7215074311415043`*^9, 3.721507433637374*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ListasDiferenca", "[", 
  RowBox[{
   RowBox[{"ExpandTemplate", "[", 
    RowBox[{"BuildTemplate", "[", 
     RowBox[{"2", ",", " ", "0.5", ",", " ", 
      RowBox[{"{", 
       RowBox[{"x3", ",", 
        RowBox[{"x3", " ", "+", " ", "1"}], ",", "x1", ",", "x0"}], "}"}], 
      ",", " ", "FilterOutOfRange"}], "]"}], "]"}], ",", 
   RowBox[{"ExpandTemplate", "[", " ", 
    RowBox[{"BuildTemplate", "[", 
     RowBox[{"2", ",", " ", "0.5", ",", " ", 
      RowBox[{"{", 
       RowBox[{"x3", ",", "x2", ",", 
        RowBox[{"x3", " ", "+", " ", "1"}], ",", 
        RowBox[{"x3", " ", "+", " ", "1"}]}], "}"}]}], "]"}], "]"}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.721427606074435*^9, 3.7214276115588512`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.7214276119925375`*^9, 3.7214614504922657`*^9, 
  3.721507437680501*^9, 3.7215074961289196`*^9, 3.72151123559978*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"DeleteDuplicates", "[", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ExpandTemplate", "[", "#", "]"}], " ", "&"}], " ", "/@", " ", 
     RowBox[{"OperacaoDiferenca", "[", 
      RowBox[{
       RowBox[{"BuildTemplate", "[", 
        RowBox[{"2", ",", " ", "0.5", ",", " ", 
         RowBox[{"{", 
          RowBox[{"x3", ",", 
           RowBox[{"x3", " ", "+", " ", "1"}], ",", "x1", ",", "x0"}], "}"}], 
         ",", 
         RowBox[{"{", " ", "FilterOutOfRange", "}"}]}], "]"}], ",", " ", 
       RowBox[{"BuildTemplate", "[", 
        RowBox[{"2", ",", " ", "0.5", ",", " ", 
         RowBox[{"{", 
          RowBox[{"x3", ",", "x2", ",", 
           RowBox[{"x3", " ", "+", " ", "1"}], ",", 
           RowBox[{"x3", " ", "+", " ", "1"}]}], "}"}]}], "]"}]}], "]"}]}], 
    " ", 
    RowBox[{"(*", "  ", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"x", "-", "k"}], ")"}], "+", "0.1"}], ")"}], " ", "%", " ", 
       "k"}], "-", "0.1"}], "  ", "*)"}], ",", " ", "1"}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.72142788177392*^9, 3.721427903124016*^9}, {
  3.721427964818356*^9, 3.7214279834812145`*^9}, {3.7214613889272428`*^9, 
  3.7214613896304398`*^9}, {3.721507473143469*^9, 3.721507486045677*^9}, {
  3.721511574500271*^9, 3.721511591460935*^9}, {3.721598064257925*^9, 
  3.7215980644454155`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "2.`", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2.`", ",", "0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2.`", ",", "1", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.721550852660915*^9, 3.721597891152926*^9, {3.7215980543223257`*^9, 
   3.7215980668987484`*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"calcular", "[", "y3_", "]"}], " ", ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "1.`"}], " ", 
    RowBox[{"Floor", "[", 
     RowBox[{"1.`*^-12", "+", 
      FractionBox["0.1`", 
       RowBox[{"Abs", "[", 
        RowBox[{"1.1`", "\[VeryThinSpace]", "+", "y3", "-", 
         RowBox[{"1.`", " ", 
          RowBox[{"Mod", "[", 
           RowBox[{
            RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", "2.`"}], 
           "]"}]}]}], "]"}]]}], "]"}]}], "+", 
   RowBox[{"Mod", "[", 
    RowBox[{
     RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", "2.`"}], "]"}], "-", 
   RowBox[{"1.`", " ", 
    RowBox[{"Floor", "[", 
     RowBox[{"1.`*^-12", "+", 
      FractionBox["0.1`", 
       RowBox[{"Abs", "[", 
        RowBox[{"1.1`", "\[VeryThinSpace]", "+", "y3", "-", 
         RowBox[{"1.`", " ", 
          RowBox[{"Mod", "[", 
           RowBox[{
            RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", "2.`"}], 
           "]"}]}]}], "]"}]]}], "]"}], " ", 
    RowBox[{"Mod", "[", 
     RowBox[{
      RowBox[{"1.`", "\[VeryThinSpace]", "+", "y3"}], ",", "2.`"}], 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.721428107816393*^9, 3.7214281691601233`*^9}, {
   3.7214285456651993`*^9, 3.7214285521964417`*^9}, {3.7214609325176315`*^9, 
   3.7214610107396345`*^9}, {3.721461050694847*^9, 3.721461066431778*^9}, {
   3.7214612619696827`*^9, 3.721461262407222*^9}, {3.7215078720252676`*^9, 
   3.7215078724002433`*^9}, {3.7215079377666845`*^9, 3.7215079427000303`*^9}, 
   3.7215079875731125`*^9, 3.7215080177469873`*^9, {3.7215080619174504`*^9, 
   3.7215080969726553`*^9}, {3.721508143155078*^9, 3.7215082158975368`*^9}, 
   3.7215083107663574`*^9, {3.721508391788518*^9, 3.7215083945066977`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"calcular", "[", "1", "]"}]], "Input",
 CellChangeTimes->{{3.721428205031478*^9, 3.721428205406479*^9}, {
  3.721428363651621*^9, 3.721428379173153*^9}, {3.721428564717391*^9, 
  3.721428584251115*^9}, {3.7214286830513625`*^9, 3.721428813967292*^9}, {
  3.721428847198491*^9, 3.7214288781607533`*^9}, {3.7214610133299284`*^9, 
  3.72146103768839*^9}, {3.7214610704946203`*^9, 3.721461070572756*^9}, {
  3.7214612700678835`*^9, 3.7214613060607796`*^9}, {3.7214613693650103`*^9, 
  3.721461371943352*^9}, {3.721461669332637*^9, 3.7214616696920414`*^9}, {
  3.7215083148946457`*^9, 3.72150831743404*^9}, {3.7215086792379646`*^9, 
  3.7215086794098396`*^9}}],

Cell[BoxData["0.`"], "Output",
 CellChangeTimes->{{3.721428196130871*^9, 3.7214282062189674`*^9}, {
   3.7214283657297344`*^9, 3.721428370715785*^9}, 3.7214285654786935`*^9, {
   3.721428685150984*^9, 3.7214287054806137`*^9}, {3.7214287515900517`*^9, 
   3.721428814451665*^9}, {3.7214288512734575`*^9, 3.7214288786138525`*^9}, {
   3.721461015594941*^9, 3.7214610710884066`*^9}, {3.7214612647043033`*^9, 
   3.721461306529541*^9}, {3.7214613541409116`*^9, 3.7214613723652487`*^9}, 
   3.721461670207698*^9, 3.721507875271201*^9, 3.721508018909659*^9, {
   3.7215080663536415`*^9, 3.7215080869323254`*^9}, {3.7215081170068717`*^9, 
   3.7215081230117693`*^9}, {3.721508168462617*^9, 3.721508184465788*^9}, {
   3.7215083125163593`*^9, 3.7215083182007847`*^9}, 3.721508395821543*^9, 
   3.721508680206691*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"(", " ", 
    RowBox[{
     RowBox[{"Mod", "[", 
      RowBox[{
       RowBox[{"0", "+", "1"}], ",", "2"}], "]"}], " ", "+", " ", "1"}], 
    ")"}], " ", "*", 
   RowBox[{"(", " ", 
    RowBox[{"1", " ", "-", " ", 
     RowBox[{"Floor", "[", 
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"0", "+", "1"}], ")"}], " ", "-", " ", 
             RowBox[{"Mod", "[", 
              RowBox[{
               RowBox[{"0", "+", "1"}], ",", "2"}], "]"}]}], ")"}], "+", 
           "0.1"}], ")"}]}], "/", "10"}], "]"}], "]"}]}], ")"}]}], "-", "1", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], " ", "+", " ", "1"}], ")"}], " ", "*",
      " ", 
     RowBox[{"(", 
      RowBox[{"1", " ", "-", " ", 
       RowBox[{"Floor", "[", 
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", "\[Equal]", 
                  " ", "2"}], ",", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "-", " ", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "+", "0.1"}], 
            ")"}]}], "/", "10"}], "]"}], "]"}]}], ")"}]}], "-", "1"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.721460861220369*^9, 3.7214608790891485`*^9}, {
  3.7215075824614086`*^9, 3.7215075891284695`*^9}, {3.7215076644841623`*^9, 
  3.721507830054759*^9}, {3.7215079932983737`*^9, 3.7215081005368433`*^9}, {
  3.721508136896233*^9, 3.7215081396329317`*^9}, {3.7215084626664906`*^9, 
  3.721508493864309*^9}, {3.721508719845695*^9, 3.721508779225732*^9}}],

Cell[BoxData[
 RowBox[{"-", "1"}]], "Output",
 CellChangeTimes->{{3.7214608718483353`*^9, 3.7214608797141857`*^9}, 
   3.721507832351627*^9, {3.7215080198545995`*^9, 3.7215080838965883`*^9}, {
   3.721508134690124*^9, 3.7215081399032707`*^9}, 3.72150849427365*^9, {
   3.7215087172892437`*^9, 3.721508784254343*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"OperacaoDiferenca", "[", 
    RowBox[{
     RowBox[{"BuildTemplate", "[", 
      RowBox[{"2", ",", " ", "0.5", ",", " ", 
       RowBox[{"{", 
        RowBox[{"x3", ",", 
         RowBox[{"x3", " ", "+", " ", "1"}], ",", "x1", ",", "1"}], "}"}], 
       ",", " ", "FilterOutOfRange"}], "]"}], ",", " ", 
     RowBox[{"BuildTemplate", "[", 
      RowBox[{"2", ",", " ", "0.5", ",", " ", 
       RowBox[{"{", 
        RowBox[{"x3", ",", "x2", ",", 
         RowBox[{"x3", " ", "+", " ", "1"}], ",", 
         RowBox[{"x3", " ", "+", " ", "1"}]}], "}"}]}], "]"}]}], "]"}], "[", 
   RowBox[{"[", "3", "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.721596817899338*^9, 3.721596822796612*^9}, {
  3.721597984807129*^9, 3.721597991035114*^9}}],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"\<\"k\"\>", "\[Rule]", "2"}], ",", 
   RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
   RowBox[{"\<\"core\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{"x1", ",", 
        RowBox[{
         RowBox[{"0", "\[LessEqual]", "x0", "<", "2"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x1", "<", "2"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x2", "<", "2"}]}]}], "]"}], ",", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"1", "+", "x1"}], ",", 
        RowBox[{
         RowBox[{"0", "\[LessEqual]", "x0", "<", "2"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x1", "<", "2"}], "&&", 
         RowBox[{"0", "\[LessEqual]", "x2", "<", "2"}]}]}], "]"}], ",", "x1", 
      ",", "1"}], "}"}]}], ",", 
   RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", "FilterOutOfRange"}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{
  3.7215968246360865`*^9, 3.721597901685112*^9, {3.721597987063778*^9, 
   3.721597993691588*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ExpandTemplate", "[", 
  RowBox[{
   RowBox[{"OperacaoDiferenca", "[", 
    RowBox[{
     RowBox[{"BuildTemplate", "[", 
      RowBox[{"2", ",", " ", "0.5", ",", " ", 
       RowBox[{"{", 
        RowBox[{"x3", ",", 
         RowBox[{"x3", " ", "+", " ", "1"}], ",", "x1", ",", "1"}], "}"}]}], 
      "]"}], ",", " ", 
     RowBox[{"BuildTemplate", "[", 
      RowBox[{"2", ",", " ", "0.5", ",", " ", 
       RowBox[{"{", 
        RowBox[{"x3", ",", "x2", ",", 
         RowBox[{"x3", " ", "+", " ", "1"}], ",", 
         RowBox[{"x3", " ", "+", " ", "1"}]}], "}"}]}], "]"}]}], "]"}], "[", 
   RowBox[{"[", "3", "]"}], "]"}], 
  RowBox[{"(*", "  ", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"x", "-", "k"}], ")"}], "+", "0.1"}], ")"}], " ", "%", " ", 
     "k"}], "-", "0.1"}], "  ", "*)"}], "]"}]], "Input",
 CellChangeTimes->{{3.7215085258006334`*^9, 3.7215085258318844`*^9}, {
  3.7215089215381317`*^9, 3.721509006724206*^9}, {3.721511264404967*^9, 
  3.7215112646862173`*^9}, {3.721548243326658*^9, 3.7215482437016897`*^9}, {
  3.721593251105911*^9, 3.721593251418438*^9}, {3.7215949077405767`*^9, 
  3.7215949188674793`*^9}, {3.7215949714731402`*^9, 3.7215949754671774`*^9}, {
  3.7215967332273674`*^9, 3.7215967567654877`*^9}, {3.72159679005114*^9, 
  3.7215968125479517`*^9}, {3.7215968508909*^9, 3.7215968512820034`*^9}, {
  3.721598011733036*^9, 3.7215980124136047`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "1", ",", "1"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.721596799117464*^9, 3.721596814808536*^9}, 
   3.721596853252512*^9, 3.721598014960695*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Expansion", "[", 
     RowBox[{"template_Association", ",", "i_Integer"}], "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"variables", "=", 
        RowBox[{"TemplateCoreVars", "[", "template", "]"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"templateCore", "[", "template", "]"}], "/.", 
       RowBox[{"TransformationRules", "[", 
        RowBox[{"variables", ",", 
         RowBox[{"Substitution", "[", 
          RowBox[{"i", ",", 
           RowBox[{"k", "[", "template", "]"}], ",", "variables"}], "]"}]}], 
        "]"}]}]}], "]"}]}], ";", 
   RowBox[{
    RowBox[{"SubstitutionRange", "[", "template_Association", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"templateCore", "[", "template", "]"}], "===", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"{", "}"}], ",", 
      RowBox[{"Range", "[", 
       RowBox[{"0", ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"template", "[", 
            RowBox[{"[", "\"\<k\>\"", "]"}], "]"}], "^", 
           RowBox[{"Length", "[", 
            RowBox[{"TemplateCoreVars", "[", "template", "]"}], "]"}]}], 
          ")"}], "-", "1"}]}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Substitution", "[", 
     RowBox[{"i_", ",", "k_", ",", "variables_"}], "]"}], ":=", 
    RowBox[{"Reverse", "[", 
     RowBox[{"IntegerDigits", "[", 
      RowBox[{"i", ",", "k", ",", 
       RowBox[{"Length", "[", "variables", "]"}]}], "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TransformationRules", "[", 
    RowBox[{"variables_", ",", "substitution_"}], "]"}], ":=", 
   RowBox[{"MapThread", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"#1", "\[Rule]", "#2"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"variables", ",", "substitution"}], "}"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"TemplateCoreVars", "[", "templateCore_List", "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"symbols", "=", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"Union", "[", 
           RowBox[{"Cases", "[", 
            RowBox[{"templateCore", ",", "_Symbol", ",", "Infinity"}], "]"}], 
           "]"}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"#", " ", "=!=", " ", "Less"}], " ", "&&", " ", 
            RowBox[{"#", " ", "=!=", " ", "LessEqual"}], " ", "&&", "  ", 
            RowBox[{"#", " ", "=!=", " ", "Greater"}], " ", "&&", " ", 
            RowBox[{"#", " ", "=!=", " ", "GreaterEqual"}]}], " ", "&"}]}], 
         "]"}]}], ",", 
       RowBox[{"byIndex", "=", 
        RowBox[{
         RowBox[{"FromDigits", "[", 
          RowBox[{"StringDrop", "[", 
           RowBox[{
            RowBox[{"SymbolName", "[", "#", "]"}], ",", "1"}], "]"}], "]"}], 
         "&"}]}]}], "}"}], ",", 
     RowBox[{"SortBy", "[", 
      RowBox[{"symbols", ",", "byIndex"}], "]"}]}], "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.721595319861519*^9, 3.7215953417082157`*^9}, {
   3.721595527930539*^9, 3.7215955297720165`*^9}, {3.7215955619280086`*^9, 
   3.721595585986251*^9}, {3.7215956566855993`*^9, 3.7215956589491854`*^9}, {
   3.7215957094052773`*^9, 3.7215957116248283`*^9}, 3.721595747072052*^9, 
   3.721596003579812*^9, {3.7215966430870028`*^9, 3.721596678855259*^9}, {
   3.7215969250921564`*^9, 3.721596946519717*^9}, {3.7215970038126097`*^9, 
   3.7215970573004637`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Expansion", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"OperacaoDiferenca", "[", 
     RowBox[{
      RowBox[{"BuildTemplate", "[", 
       RowBox[{"2", ",", " ", "0.5", ",", " ", 
        RowBox[{"{", 
         RowBox[{"x3", ",", 
          RowBox[{"x3", " ", "+", " ", "1"}], ",", "x1", ",", "1"}], "}"}], 
        ",", " ", "FilterOutOfRange"}], "]"}], ",", " ", 
      RowBox[{"BuildTemplate", "[", 
       RowBox[{"2", ",", " ", "0.5", ",", " ", 
        RowBox[{"{", 
         RowBox[{"x3", ",", "x2", ",", 
          RowBox[{"x3", " ", "+", " ", "1"}], ",", 
          RowBox[{"x3", " ", "+", " ", "1"}]}], "}"}]}], "]"}]}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}], ",", " ", "1"}], "]"}]], "Input",
 CellChangeTimes->{{3.721595349585251*^9, 3.721595498071791*^9}, {
  3.7215956336286135`*^9, 3.7215956423448505`*^9}, {3.7215958952545166`*^9, 
  3.7215958997296753`*^9}, {3.7215968698698273`*^9, 3.721596910099266*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "Undefined", ",", 
   RowBox[{"-", "1"}], ",", "Undefined"}], "}"}]], "Output",
 CellChangeTimes->{3.721596911945743*^9, 3.7215970314557557`*^9, 
  3.7215970840864134`*^9, 3.7215977890559278`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Expansion", "[", 
  RowBox[{
   RowBox[{"BuildTemplate", "[", 
    RowBox[{"2", ",", " ", "0.5", ",", " ", 
     RowBox[{"{", 
      RowBox[{"x3", ",", 
       RowBox[{"x3", " ", "+", " ", "1"}], ",", "x1", ",", "1"}], "}"}], ",", 
     " ", "FilterOutOfRange"}], "]"}], ",", " ", "1"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "1", ",", "1", ",", "1"}], "}"}]], "Input",
 CellChangeTimes->{3.7215970341894646`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "1", ",", "1", ",", "1"}], "}"}]], "Output",
 CellChangeTimes->{3.7215970342434945`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ConditionalExpression", "  ", "@@", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "\[VeryThinSpace]", "+", "y3"}], " ", ",", 
     RowBox[{
      RowBox[{"0", "\[LessEqual]", "x0", "<", "2"}], " ", "&&", 
      RowBox[{"0", "\[LessEqual]", "x2", "<", "2"}], " ", "&&", 
      RowBox[{"1", " ", "\[LessEqual]", "y3", "<", "2"}]}]}], " ", "}"}]}], 
  " ", "/.", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"x0", "\[Rule]", "1"}], ",", 
    RowBox[{"x2", "\[Rule]", "0"}], ",", 
    RowBox[{"y3", "\[Rule]", "0"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.721597091146265*^9, 3.721597168088214*^9}, {
   3.7215972137981005`*^9, 3.721597221039955*^9}, {3.7215972679121456`*^9, 
   3.7215973217390857`*^9}, 3.721597487259694*^9, {3.7215975196944876`*^9, 
   3.7215975423394566`*^9}, {3.721597704285674*^9, 3.721597724386288*^9}}],

Cell[BoxData["Undefined"], "Output",
 CellChangeTimes->{
  3.7215975427144623`*^9, {3.721597708935393*^9, 3.721597730559523*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Select", "[", 
  RowBox[{
   RowBox[{"Union", "[", 
    RowBox[{"Cases", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"OperacaoDiferenca", "[", 
        RowBox[{
         RowBox[{"BuildTemplate", "[", 
          RowBox[{"2", ",", " ", "0.5", ",", " ", 
           RowBox[{"{", 
            RowBox[{"x3", ",", 
             RowBox[{"x3", " ", "+", " ", "1"}], ",", "x1", ",", "1"}], "}"}],
            ",", " ", "FilterOutOfRange"}], "]"}], ",", " ", 
         RowBox[{"BuildTemplate", "[", 
          RowBox[{"2", ",", " ", "0.5", ",", " ", 
           RowBox[{"{", 
            RowBox[{"x3", ",", "x2", ",", 
             RowBox[{"x3", " ", "+", " ", "1"}], ",", 
             RowBox[{"x3", " ", "+", " ", "1"}]}], "}"}]}], "]"}]}], "]"}], 
       "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "_Symbol", ",", "Infinity"}], 
     "]"}], "]"}], ",", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"#", " ", "=!=", " ", "Less"}], " ", "&&", " ", 
     RowBox[{"#", " ", "=!=", " ", "LessEqual"}], " ", "&&", "  ", 
     RowBox[{"#", " ", "=!=", " ", "Greater"}], " ", "&&", " ", 
     RowBox[{"#", " ", "=!=", " ", "GreaterEqual"}]}], " ", "&"}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.7215960339767017`*^9, 3.72159606503576*^9}, {
  3.721596111063706*^9, 3.7215961749372807`*^9}, {3.7215962077127867`*^9, 
  3.721596261096986*^9}, {3.7215962954198923`*^9, 3.7215963481765823`*^9}, {
  3.7215964669842772`*^9, 3.7215964855771046`*^9}, {3.721596531347981*^9, 
  3.7215966216284065`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"FilterOutOfRange", ",", "x0", ",", "x2", ",", "y3"}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.7215960445354414`*^9, 3.7215961352750034`*^9}, {
   3.7215961705141315`*^9, 3.7215961783671684`*^9}, 3.7215962167701335`*^9, {
   3.7215962546363063`*^9, 3.7215962632555428`*^9}, {3.721596300112107*^9, 
   3.721596305645543*^9}, {3.7215964771819334`*^9, 3.721596487526608*^9}, {
   3.7215965404783487`*^9, 3.7215965779800797`*^9}, 3.721596624644189*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ReplacementRules", "[", 
  RowBox[{
   RowBox[{"BuildTemplate", "[", 
    RowBox[{"2", ",", " ", "0.5", ",", " ", 
     RowBox[{"{", 
      RowBox[{"x3", ",", "x2", ",", "x1", ",", "1"}], "}"}]}], "]"}], ",", 
   " ", 
   RowBox[{"BuildTemplate", "[", 
    RowBox[{"2", ",", "0.5", ",", 
     RowBox[{"{", 
      RowBox[{"y3", ",", "y2", ",", "y1", ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"y3", "-", "1"}], ")"}], "-", 
        RowBox[{
         RowBox[{"Floor", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"y3", "-", "1"}], ")"}], "/", "2"}], "]"}], "*", 
         "2"}]}]}], " ", "}"}]}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7215090768750114`*^9, 3.7215091588157487`*^9}, {
   3.7215091905135937`*^9, 3.7215092545512896`*^9}, {3.721509383885867*^9, 
   3.721509389012892*^9}, {3.721509436517508*^9, 3.7215094366323853`*^9}, {
   3.721509502687244*^9, 3.721509513163124*^9}, {3.7215095697530155`*^9, 
   3.7215096753863544`*^9}, {3.7215097176223145`*^9, 3.721509740256694*^9}, {
   3.7215098368651514`*^9, 3.7215098371216516`*^9}, {3.7215099736767855`*^9, 
   3.721509975598667*^9}, {3.721510013735245*^9, 3.721510014157121*^9}, {
   3.721510068501069*^9, 3.7215100690803003`*^9}, {3.7215102110840816`*^9, 
   3.721510216683303*^9}, {3.72151052876778*^9, 3.7215105322756357`*^9}, {
   3.7215105822599044`*^9, 3.721510614228625*^9}, {3.7215106455752907`*^9, 
   3.721510670137535*^9}, {3.721510762721611*^9, 3.721510763174738*^9}, {
   3.721510822739716*^9, 3.7215108298922305`*^9}, {3.7215109650429215`*^9, 
   3.7215109657158775`*^9}, {3.7215110359736905`*^9, 
   3.7215110442123632`*^9}, {3.7215110746263103`*^9, 3.721511075853798*^9}, 
   3.721511754818495*^9, {3.7215120468799253`*^9, 3.7215120779340563`*^9}, {
   3.7215122071138725`*^9, 3.7215122131222734`*^9}, {3.7215123007405376`*^9, 
   3.7215123358304634`*^9}, {3.7215125607484875`*^9, 
   3.7215125706391644`*^9}, {3.7215127089837604`*^9, 
   3.7215127277660656`*^9}, {3.721513063128867*^9, 3.7215130678777037`*^9}, {
   3.7215480842951956`*^9, 3.7215481129165125`*^9}, {3.7215482576050625`*^9, 
   3.7215482616704264`*^9}, {3.7215931976001835`*^9, 3.721593197951618*^9}, {
   3.721593263068905*^9, 3.721593263397032*^9}, {3.7215932956974435`*^9, 
   3.7215933677214365`*^9}, {3.721593412573531*^9, 3.721593423760275*^9}, {
   3.7215937022451277`*^9, 3.7215937247373114`*^9}, {3.7215978362785015`*^9, 
   3.721597859118887*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"x1", "\[Rule]", 
     RowBox[{"ConditionalExpression", "[", 
      RowBox[{"y1", ",", 
       RowBox[{
        RowBox[{"0", "\[LessEqual]", "x0", "<", "2"}], "&&", 
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y1", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y1", "]"}], "\[Equal]", "0"}], "&&", 
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y2", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y2", "]"}], "\[Equal]", "0"}]}]}], "]"}]}], ",", 
    RowBox[{"x2", "\[Rule]", 
     RowBox[{"ConditionalExpression", "[", 
      RowBox[{"y2", ",", 
       RowBox[{
        RowBox[{"0", "\[LessEqual]", "x0", "<", "2"}], "&&", 
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y1", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y1", "]"}], "\[Equal]", "0"}], "&&", 
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y2", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y2", "]"}], "\[Equal]", "0"}]}]}], "]"}]}], ",", 
    RowBox[{"x3", "\[Rule]", 
     RowBox[{"ConditionalExpression", "[", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"0", "\[LessEqual]", "x0", "<", "2"}], "&&", 
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y1", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y1", "]"}], "\[Equal]", "0"}], "&&", 
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y2", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y2", "]"}], "\[Equal]", "0"}]}]}], "]"}]}], ",", 
    RowBox[{"y3", "\[Rule]", 
     RowBox[{"ConditionalExpression", "[", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"0", "\[LessEqual]", "x0", "<", "2"}], "&&", 
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y1", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y1", "]"}], "\[Equal]", "0"}], "&&", 
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y2", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y2", "]"}], "\[Equal]", "0"}]}]}], "]"}]}]}], 
   "}"}], "}"}]], "Output",
 CellChangeTimes->{
  3.7215090888846593`*^9, 3.7215091213502846`*^9, {3.7215091706057*^9, 
   3.721509207705311*^9}, {3.7215093777597256`*^9, 3.721509389872243*^9}, 
   3.721509437538612*^9, {3.7215095032554197`*^9, 3.7215095299997687`*^9}, {
   3.721509566156176*^9, 3.721509675985467*^9}, {3.721509719924713*^9, 
   3.7215097424574428`*^9}, 3.721509837496662*^9, 3.7215099760048904`*^9, {
   3.7215100491520753`*^9, 3.721510069533399*^9}, {3.7215102135083313`*^9, 
   3.7215102170361266`*^9}, 3.721510529603725*^9, {3.721510667570022*^9, 
   3.721510670496922*^9}, {3.7215107322710075`*^9, 3.7215108305238295`*^9}, {
   3.7215108757746773`*^9, 3.7215109036609335`*^9}, 3.7215109662471437`*^9, {
   3.721511032870551*^9, 3.7215110766518974`*^9}, 3.721511204570691*^9, {
   3.7215117520468893`*^9, 3.7215117555541244`*^9}, {3.721512044199342*^9, 
   3.7215120891191797`*^9}, 3.7215121219823875`*^9, 3.7215121584441195`*^9, 
   3.7215121899425125`*^9, 3.7215122284261355`*^9, {3.72151231817097*^9, 
   3.721512343063197*^9}, 3.721512536477909*^9, {3.721512600868307*^9, 
   3.7215126099605837`*^9}, {3.721512712085225*^9, 3.7215127281722937`*^9}, 
   3.7215130182819777`*^9, {3.7215130512230854`*^9, 3.721513068565217*^9}, 
   3.7215131527121944`*^9, 3.7215474071856503`*^9, {3.7215474499727983`*^9, 
   3.7215475147798357`*^9}, {3.7215476012124376`*^9, 3.7215476196181946`*^9}, 
   3.72154766330105*^9, 3.7215477149937377`*^9, 3.721547801439349*^9, {
   3.721547913388464*^9, 3.7215479513650923`*^9}, 3.721547985873151*^9, {
   3.721548016702985*^9, 3.721548041981426*^9}, {3.7215480852327623`*^9, 
   3.7215481410554495`*^9}, 3.7215481874625344`*^9, {3.721548252634597*^9, 
   3.721548279131464*^9}, 3.7215496352279177`*^9, 3.721549706502143*^9, 
   3.721549748523839*^9, 3.7215498225199385`*^9, 3.721549867528027*^9, 
   3.721549930465629*^9, 3.7215499763498907`*^9, {3.721550057410581*^9, 
   3.7215500702409086`*^9}, 3.721550104170603*^9, 3.721550142142969*^9, 
   3.7215501807319*^9, {3.7215502208221216`*^9, 3.721550269154998*^9}, 
   3.7215503197799845`*^9, {3.7215504074674935`*^9, 3.7215504766503043`*^9}, {
   3.721550518894594*^9, 3.7215505698049297`*^9}, {3.7215506477259116`*^9, 
   3.7215507435810385`*^9}, 3.721550793923466*^9, 3.721593156241722*^9, {
   3.7215932422061644`*^9, 3.721593268768778*^9}, {3.721593341237162*^9, 
   3.721593375283027*^9}, 3.721593424089923*^9, {3.721593550873164*^9, 
   3.721593571609829*^9}, {3.7215936404278183`*^9, 3.7215936596295247`*^9}, {
   3.7215937253366656`*^9, 3.7215937494031053`*^9}, {3.721594459083744*^9, 
   3.7215944720848255`*^9}, {3.7215948341928935`*^9, 3.721594885931163*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReplacementRules", "[", 
   RowBox[{"template1_Association", ",", "template2_Association"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"k", "=", 
       RowBox[{"k", "[", "template1", "]"}]}], ",", 
      RowBox[{"rawTemplate1", "=", 
       RowBox[{"RawCore", "[", 
        RowBox[{"templateCore", "[", "template1", "]"}], "]"}]}], ",", 
      RowBox[{"rawTemplate2", "=", 
       RowBox[{"RawCore", "[", 
        RowBox[{"templateCore", "[", "template2", "]"}], "]"}]}], ",", 
      RowBox[{"baseCore", "=", 
       RowBox[{"BaseTemplateCore", "[", 
        RowBox[{
         RowBox[{"k", "[", "template1", "]"}], ",", 
         RowBox[{"r", "[", "template1", "]"}]}], "]"}]}], ",", 
      "templateVars"}], "}"}], ",", 
    RowBox[{
     RowBox[{"templateVars", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{"Union", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"TemplateCoreVars", "[", "#", "]"}], "&"}], "/@", 
            RowBox[{"{", 
             RowBox[{"rawTemplate1", ",", "rawTemplate2", ",", "baseCore"}], 
             "}"}]}], ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{"FromDigits", "[", 
          RowBox[{"StringDrop", "[", 
           RowBox[{
            RowBox[{"SymbolName", "[", "#", "]"}], ",", "1"}], "]"}], "]"}], 
         "&"}]}], "]"}]}], ";", 
     RowBox[{"symbols", "=", 
      RowBox[{"Union", "[", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"rawTemplate1", ",", 
          RowBox[{
           RowBox[{"#", "\[Equal]", "Symbol"}], "&"}]}], "]"}], ",", 
        RowBox[{"Select", "[", 
         RowBox[{"rawTemplate2", ",", 
          RowBox[{
           RowBox[{"#", "\[Equal]", "Symbol"}], "&"}]}], "]"}], ",", 
        "baseCore"}], "]"}]}], ";", "\n", 
     RowBox[{"equationK", "=", 
      RowBox[{"Union", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "\[GreaterEqual]", "0"}], "&"}], "/@", "symbols"}], 
        ",", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "<", "k"}], "&"}], "/@", "symbols"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Solve", "[", 
       RowBox[{
        RowBox[{"Union", "[", 
         RowBox[{"equationK", ",", " ", 
          RowBox[{"EquationSystem", "[", 
           RowBox[{"rawTemplate1", ",", "rawTemplate2"}], "]"}]}], "]"}], ",",
         "templateVars"}], " ", "]"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.721512122404291*^9, 3.7215121722287955`*^9}, {
   3.7215122327709675`*^9, 3.721512275420588*^9}, {3.7215123398736067`*^9, 
   3.721512340750126*^9}, {3.72151253310767*^9, 3.721512545164281*^9}, {
   3.7215125994464383`*^9, 3.721512606616838*^9}, {3.7215126708430824`*^9, 
   3.7215127184258027`*^9}, {3.7215130404424496`*^9, 
   3.7215130454931087`*^9}, {3.721513077113628*^9, 3.7215130811058664`*^9}, 
   3.721513149555951*^9, {3.7215474264114847`*^9, 3.721547948204534*^9}, {
   3.72154798290818*^9, 3.721548022016523*^9}, {3.721548097911192*^9, 
   3.7215481390084248`*^9}, {3.7215504605475817`*^9, 
   3.7215505675390186`*^9}, {3.7215506371713514`*^9, 3.721550645678876*^9}, {
   3.721593534191889*^9, 3.7215935687904725`*^9}, 3.721593604533313*^9, {
   3.7215936363836517`*^9, 3.721593657558033*^9}, {3.7215937420685863`*^9, 
   3.721593747387869*^9}, {3.721594016749921*^9, 3.7215940515984244`*^9}, {
   3.7215944015990934`*^9, 3.721594410817296*^9}, {3.721594448355624*^9, 
   3.7215944694514437`*^9}, {3.7215948503780937`*^9, 3.7215948830425835`*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.721547611635689*^9, 3.7215476147546124`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Solve", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "\[Equal]", 
      RowBox[{
       RowBox[{"-", "1"}], "+", "y3", "-", 
       RowBox[{"2", " ", 
        RowBox[{"Floor", "[", 
         RowBox[{
          FractionBox["1", "2"], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "1"}], "+", "y3", " ", "+", " ", "y1"}], ")"}]}], 
         "]"}]}]}]}], ",", 
     RowBox[{"x1", "\[Equal]", "y1"}], ",", 
     RowBox[{"x2", "\[Equal]", "y2"}], ",", 
     RowBox[{"x3", "\[Equal]", "y3"}], ",", 
     RowBox[{
      RowBox[{"x1", " ", "\[GreaterEqual]", " ", "0"}], ";", " ", 
      RowBox[{"x1", " ", "<", " ", "2"}]}], ",", 
     RowBox[{"x3", "\[GreaterEqual]", "0"}], ",", 
     RowBox[{"x3", "<", "2"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "x0", ",", "x1", ",", "y1", ",", "x2", ",", "y2", ",", "x3", ",", "y3", 
     ",", "x0", ",", " ", "y0"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7215505797738934`*^9, 3.721550614299286*^9}, {
  3.7215940565119944`*^9, 3.721594077510641*^9}, {3.721594130111725*^9, 
  3.721594197660862*^9}, {3.721594234843191*^9, 3.721594278320295*^9}, {
  3.721594319785654*^9, 3.721594378651085*^9}, {3.7215944878887763`*^9, 
  3.7215945000994053`*^9}, {3.721594616072978*^9, 3.721594674120411*^9}, {
  3.7215947048358173`*^9, 3.7215947313786154`*^9}}],

Cell[BoxData[
 TemplateBox[{
  "Solve","svars",
   "\"Equations may not give solutions for all \\\"solve\\\" variables.\"",2,
   84,32,29443218587744544074,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.7215940779896727`*^9, {3.7215941380644093`*^9, 3.7215941982859*^9}, {
   3.7215942527144527`*^9, 3.7215942790687275`*^9}, {3.7215943206506915`*^9, 
   3.721594379208321*^9}, 3.721594489146172*^9, 3.7215945230725846`*^9, {
   3.7215946205234737`*^9, 3.7215946479477825`*^9}, 3.721594678180298*^9, {
   3.72159471231149*^9, 3.721594732113926*^9}, 3.721594836514494*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"x1", "\[Rule]", 
     RowBox[{"ConditionalExpression", "[", 
      RowBox[{"y1", ",", 
       RowBox[{
        RowBox[{"-", "1"}], "\[LessEqual]", "y1", "<", "1"}]}], "]"}]}], ",", 
    RowBox[{"y2", "\[Rule]", 
     RowBox[{"ConditionalExpression", "[", 
      RowBox[{"x2", ",", 
       RowBox[{
        RowBox[{"-", "1"}], "\[LessEqual]", "y1", "<", "1"}]}], "]"}]}], ",", 
    RowBox[{"x3", "\[Rule]", 
     RowBox[{"ConditionalExpression", "[", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"-", "1"}], "\[LessEqual]", "y1", "<", "1"}]}], "]"}]}], ",", 
    RowBox[{"y3", "\[Rule]", 
     RowBox[{"ConditionalExpression", "[", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"-", "1"}], "\[LessEqual]", "y1", "<", "1"}]}], "]"}]}]}], 
   "}"}], "}"}]], "Output",
 CellChangeTimes->{{3.7215941380644093`*^9, 3.721594198301527*^9}, {
   3.721594252730089*^9, 3.7215942790843678`*^9}, {3.721594320664695*^9, 
   3.7215943792239475`*^9}, 3.721594489161812*^9, 3.7215945230725846`*^9, {
   3.7215946205390987`*^9, 3.721594647963409*^9}, 3.721594678195927*^9, {
   3.7215947123271165`*^9, 3.7215947321295652`*^9}, 3.721594836530499*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ConditionalExpression", "[", 
   RowBox[{"2.", ",", 
    RowBox[{"0", " ", "\[LessEqual]", "  ", 
     RowBox[{"Im", "[", "x", "]"}]}]}], "]"}], " ", "/.", " ", 
  RowBox[{"x", "\[Rule]", " ", "1"}]}]], "Input",
 CellChangeTimes->{{3.7215941047545586`*^9, 3.721594117702421*^9}, {
  3.721594949812506*^9, 3.7215949653755584`*^9}, {3.721595024641938*^9, 
  3.7215951278457193`*^9}}],

Cell[BoxData["2.`"], "Output",
 CellChangeTimes->{{3.7215949510118165`*^9, 3.721594966866931*^9}, {
  3.7215950432017393`*^9, 3.721595128624892*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EquationSystem", "[", 
    RowBox[{
    "template1_List", ",", "template2_List", ",", " ", "template3_List"}], 
    "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Equal", "@@", "#"}], "&"}], "/@", 
    RowBox[{"Transpose", "[", 
     RowBox[{"{", 
      RowBox[{"template1", ",", "template2", ",", " ", "template3"}], "}"}], 
     "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.721513020891388*^9, 3.7215130356263466`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"valueRestrictions", "[", 
  RowBox[{"BuildTemplate", "[", 
   RowBox[{"2", ",", " ", "0.5", ",", " ", 
    RowBox[{"{", 
     RowBox[{"x3", ",", "x2", ",", "x1", ",", "x0"}], "}"}]}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.721510389670032*^9, 3.721510490122096*^9}}],

Cell[BoxData[
 RowBox[{"{", "}"}]], "Output",
 CellChangeTimes->{{3.721510424007083*^9, 3.7215104353874874`*^9}, {
   3.7215104709471254`*^9, 3.7215104905402255`*^9}, 3.721510816923489*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"TemplateIntersectionTest", "[", 
    RowBox[{"template1_Association", ",", "template2_Association"}], "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"renamedTemplate2", "=", 
       RowBox[{"XVarsToYVars", "[", "template2", "]"}]}], "}"}], ",", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"k", "=", 
          RowBox[{"k", "[", "template1", "]"}]}], ",", 
         RowBox[{"r", "=", 
          RowBox[{"r", "[", "template1", "]"}]}], ",", 
         RowBox[{"expansion", "=", 
          RowBox[{"PostExpansionFnFight", "[", 
           RowBox[{"template1", ",", "template2"}], "]"}]}], ",", 
         RowBox[{"replacementRules", "=", 
          RowBox[{"ReplacementRules", "[", 
           RowBox[{"template1", ",", "renamedTemplate2"}], "]"}]}], ",", 
         RowBox[{"intersectionFn", "=", 
          RowBox[{"IntersectionFn", "[", 
           RowBox[{"template1", ",", "template2"}], "]"}]}], ",", 
         RowBox[{"restrictions", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"valueRestrictions", "[", "template1", "]"}], ",", 
            RowBox[{"valueRestrictions", "[", "template2", "]"}]}], "]"}]}], 
         ",", "intersectionResult"}], "}"}], ",", 
       RowBox[{
        RowBox[{"intersectionResult", "=", 
         RowBox[{"ValueRestrictionIntersection", "[", 
          RowBox[{
           RowBox[{"intersectionFn", "[", 
            RowBox[{
            "replacementRules", ",", "template1", ",", "renamedTemplate2"}], 
            "]"}], ",", "restrictions", ",", "replacementRules"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"ValidTemplateCoreQ", "[", "intersectionResult", "]"}], ",", 
          RowBox[{"BuildTemplate", "[", 
           RowBox[{
           "k", ",", "r", ",", "intersectionResult", ",", "expansion"}], 
           "]"}], ",", 
          RowBox[{"BuildTemplate", "[", 
           RowBox[{"k", ",", "r", ",", 
            RowBox[{"{", "}"}], ",", "expansion"}], "]"}]}], "]"}]}]}], 
      "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7215105223870497`*^9, 3.721510525195181*^9}, 
   3.721510570831921*^9, {3.721510605117573*^9, 3.7215106086922045`*^9}, {
   3.7215106772825947`*^9, 3.7215107121303926`*^9}, {3.7215107477976217`*^9, 
   3.7215107515483737`*^9}, {3.721510811060206*^9, 3.721510887594452*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MatchQ", "[", 
  RowBox[{
   RowBox[{"Mod", "[", 
    RowBox[{"x3", ",", " ", "2"}], "]"}], ",", 
   RowBox[{"(", 
    RowBox[{
    "_Symbol", "|", "_Mod", " ", "|", "_Integer", "|", "_Plus", "|", "_Times",
      "|", 
     RowBox[{"_", "\[Element]", 
      RowBox[{"{", "__", "}"}]}]}], ")"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7215111267569356`*^9, 3.7215111295288877`*^9}, {
  3.7215111634226284`*^9, 3.7215111771480727`*^9}}],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{
  3.7215111302957234`*^9, {3.7215111691205482`*^9, 3.7215111774605713`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"x3", "[", 
  RowBox[{"[", "0", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.721511133450324*^9, 3.7215111561399193`*^9}}],

Cell[BoxData["Symbol"], "Output",
 CellChangeTimes->{{3.721511136670788*^9, 3.721511156561769*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SubsetQ", "[", 
  RowBox[{
   RowBox[{"Range", "[", 
    RowBox[{"0", ",", 
     RowBox[{"2", "-", "1"}]}], "]"}], ",", 
   RowBox[{"Union", "[", 
    RowBox[{"Cases", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", " ", "1", ",", "1", ",", 
        RowBox[{"-", "1"}]}], "}"}], ",", "x_Integer", ",", "2"}], "]"}], 
    "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7215114392167244`*^9, 3.7215114780118275`*^9}}],

Cell[BoxData["False"], "Output",
 CellChangeTimes->{{3.7215114631022687`*^9, 3.7215114786993027`*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FilterOutOfRangeB", "[", 
    RowBox[{"template_Association", ",", " ", "expansion_List"}], "]"}], " ", 
   ":=", "\n", "  ", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"SubsetQ", "[", 
      RowBox[{
       RowBox[{"Range", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{
          RowBox[{"k", "[", "template", "]"}], " ", "-", " ", "1"}]}], "]"}], 
       ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"IntegerPart", "[", "#", "]"}], " ", "==", " ", "#"}], 
           ",", " ", 
           RowBox[{"IntegerPart", "[", "#", "]"}], ",", " ", "#"}], "]"}], 
         " ", "&"}], " ", "/@", " ", "expansion"}]}], "]"}], ",", "\n", 
     "    ", 
     RowBox[{
      RowBox[{
       RowBox[{"IntegerPart", "[", "#", "]"}], " ", "&"}], " ", "/@", " ", 
      "expansion"}], ",", "\n", "    ", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "If", " ", "the", " ", "expansion", " ", "is", " ", "supposed", " ", 
        "to", " ", "be", " ", "filtered"}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
          "we", " ", "return", " ", "the", " ", "special", " ", "##"}], "&"}],
          "[", "]"}], " ", "function"}], ",", " ", 
       RowBox[{
        RowBox[{"which", " ", "vanishes", " ", "once", " ", 
         RowBox[{"evaluated", ".", "\n", "       ", "More"}], " ", "info", 
         " ", 
         RowBox[{"on", ":", "\n", "       ", "http", ":"}]}], "//", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"stackoverflow", ".", "com"}], "/", "questions"}], "/", 
           "8877324"}], "/", "how"}], "-", "to", "-", "remove", "-", "the", 
         "-", "null", "-", "symbol", "-", "in", "-", "a", "-", "table", "-", 
         "in", "-", "mathematica"}]}]}], " ", "*)"}], "\n", "    ", 
     RowBox[{
      RowBox[{
       RowBox[{"(", "##", ")"}], " ", "&"}], " ", "[", "]"}]}], "\n", "  ", 
    "]"}]}], ";"}]], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Solve", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x3", "\[Equal]", "y3"}], ",", 
     RowBox[{"x2", "\[Equal]", "y2"}], ",", 
     RowBox[{"x1", "\[Equal]", "y1"}], ",", 
     RowBox[{"1", "\[Equal]", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "1"}], "+", "y3"}], ",", "2"}], "]"}]}], ",", 
     RowBox[{"y3", "\[GreaterEqual]", " ", "0"}], ",", 
     RowBox[{"y3", "<", "2"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"x1", ",", "y1", ",", "x2", ",", "y2", ",", "x3", ",", "y3"}], 
    "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7215117815474386`*^9, 3.721511828739278*^9}, {
  3.721511862252802*^9, 3.7215119195336018`*^9}, {3.7215145892142143`*^9, 
  3.721514737297473*^9}}],

Cell[BoxData[
 TemplateBox[{
  "Solve","svars",
   "\"Equations may not give solutions for all \\\"solve\\\" variables.\"",2,
   7,7,29442703638120206136,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.7215119341996202`*^9, 3.721512030752491*^9, {3.721514579398799*^9, 
   3.721514599332238*^9}, {3.721514645523709*^9, 3.7215146631650224`*^9}, {
   3.721514695244356*^9, 3.721514739404704*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"y1", "\[Rule]", "x1"}], ",", 
    RowBox[{"y2", "\[Rule]", "x2"}], ",", 
    RowBox[{"x3", "\[Rule]", "0"}], ",", 
    RowBox[{"y3", "\[Rule]", "0"}]}], "}"}], "}"}]], "Output",
 CellChangeTimes->{
  3.721512030752491*^9, {3.721514579398799*^9, 3.7215145993478622`*^9}, {
   3.721514645539334*^9, 3.721514663180648*^9}, {3.721514695259981*^9, 
   3.721514739404704*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Solve", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x3", "\[Equal]", "y3"}], ",", 
     RowBox[{"x2", "\[Equal]", "y2"}], ",", 
     RowBox[{"x1", "\[Equal]", "y1"}], ",", 
     RowBox[{"x0", "\[Equal]", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "1"}], "+", "y3"}], ",", "2"}], "]"}]}], ",", " ", 
     RowBox[{"y0", " ", "==", " ", 
      RowBox[{"x1", " ", "+", "1"}]}], ",", " ", 
     RowBox[{"y0", " ", "\[Equal]", "x0"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "x1", ",", "y1", ",", "x2", ",", "y2", ",", "x3", ",", "y3", ",", " ", 
     "y0", ",", " ", "x0"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.721511982750355*^9, 3.7215120145040674`*^9}}],

Cell[BoxData[
 TemplateBox[{
  "Solve","svars",
   "\"Equations may not give solutions for all \\\"solve\\\" variables.\"",2,
   52,42,29442681611948556047,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.7215120150683136`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"x1", "\[Rule]", 
     RowBox[{
      RowBox[{"-", "1"}], "+", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "1"}], "+", "y3"}], ",", "2"}], "]"}]}]}], ",", 
    RowBox[{"y1", "\[Rule]", 
     RowBox[{
      RowBox[{"-", "1"}], "+", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "1"}], "+", "y3"}], ",", "2"}], "]"}]}]}], ",", 
    RowBox[{"y2", "\[Rule]", "x2"}], ",", 
    RowBox[{"x3", "\[Rule]", "y3"}], ",", 
    RowBox[{"y0", "\[Rule]", 
     RowBox[{"Mod", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "1"}], "+", "y3"}], ",", "2"}], "]"}]}], ",", 
    RowBox[{"x0", "\[Rule]", 
     RowBox[{"Mod", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "1"}], "+", "y3"}], ",", "2"}], "]"}]}]}], "}"}], 
  "}"}]], "Output",
 CellChangeTimes->{3.7215120150683136`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Importante", ":", " ", 
      RowBox[{"Alterado", " ", "no", " ", "arquivo", " ", 
       RowBox[{"CATemplate", ".", "wl"}], " ", "a", " ", "linha", " ", 
       RowBox[{"ValidTemplateCoreQ", "[", "templateCore_", "]"}]}]}], ":=", 
     RowBox[{"And", "@@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"MatchQ", "[", 
          RowBox[{"#", ",", 
           RowBox[{"(", 
            RowBox[{
            "_Symbol", "|", "_Mod", "|", "_Integer", "|", "_Plus", "|", 
             "_Times", "|", 
             RowBox[{"_", "\[Element]", 
              RowBox[{"{", "__", "}"}]}]}], ")"}]}], "]"}], "&"}], "/@", 
        "templateCore"}], ")"}]}]}], ";"}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.7215123913441734`*^9, 3.721512417799611*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"k", "=", 
          RowBox[{"k", "[", "template1", "]"}]}], ",", 
         RowBox[{"rawTemplate1", "=", 
          RowBox[{"RawCore", "[", 
           RowBox[{"templateCore", "[", "template1", "]"}], "]"}]}], ",", 
         RowBox[{"rawTemplate2", "=", 
          RowBox[{"RawCore", "[", 
           RowBox[{"templateCore", "[", "template2", "]"}], "]"}]}], ",", 
         "templateVars"}], "}"}], ",", 
       RowBox[{
        RowBox[{"templateVars", "=", 
         RowBox[{"SortBy", "[", 
          RowBox[{
           RowBox[{"Union", "[", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"TemplateCoreVars", "[", "#", "]"}], "&"}], "/@", 
               RowBox[{"{", 
                RowBox[{"rawTemplate1", ",", "rawTemplate2"}], "}"}]}], ",", 
              "1"}], "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"FromDigits", "[", 
             RowBox[{"StringDrop", "[", 
              RowBox[{
               RowBox[{"SymbolName", "[", "#", "]"}], ",", "1"}], "]"}], 
             "]"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"baseCore", "=", 
         RowBox[{"BaseTemplateCore", "[", 
          RowBox[{
           RowBox[{"k", "[", "template1", "]"}], ",", 
           RowBox[{"r", "[", "template1", "]"}]}], "]"}]}]}]}], "]"}], ";"}], 
    "\n", 
    RowBox[{
     RowBox[{"symbols", "=", 
      RowBox[{"Union", "[", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"rawTemplate1", ",", 
          RowBox[{
           RowBox[{"#", "\[Equal]", "Symbol"}], "&"}]}], "]"}], ",", 
        RowBox[{"Select", "[", 
         RowBox[{"rawTemplate2", ",", 
          RowBox[{
           RowBox[{"#", "\[Equal]", "Symbol"}], "&"}]}], "]"}], ",", 
        "baseCore"}], "]"}]}], ";"}], "\n", 
    RowBox[{
     RowBox[{"equationK", "=", 
      RowBox[{"Union", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "\[GreaterEqual]", "0"}], "&"}], "/@", "symbols"}], 
        ",", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "<", "k"}], "&"}], "/@", "symbols"}]}], "]"}]}], ";"}],
     "\n", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"ModIntersectionNeededQ", "[", 
       RowBox[{"template1", ",", "template2"}], "]"}], ",", 
      RowBox[{"Quiet", "[", 
       RowBox[{
        RowBox[{"Solve", "[", 
         RowBox[{
          RowBox[{"Union", "[", 
           RowBox[{
            RowBox[{"EquationSystem", "[", 
             RowBox[{"rawTemplate1", ",", "rawTemplate2"}], "]"}], ",", 
            RowBox[{"EquationSystem", "[", 
             RowBox[{"rawTemplate1", ",", "baseCore"}], "]"}], ",", 
            "equationK"}], "]"}], ",", 
          RowBox[{"Reverse", "[", "templateVars", "]"}]}], "]"}], ",", 
        RowBox[{"Modulus", "\[Rule]", "k"}]}], "]"}], ",", 
      RowBox[{"Quiet", "[", 
       RowBox[{"Solve", "[", 
        RowBox[{
         RowBox[{"Union", "[", 
          RowBox[{
           RowBox[{"EquationSystem", "[", 
            RowBox[{"rawTemplate1", ",", "rawTemplate2"}], "]"}], ",", 
           RowBox[{"EquationSystem", "[", 
            RowBox[{"rawTemplate1", ",", "baseCore"}], "]"}], ",", 
           "equationK"}], "]"}], ",", "templateVars"}], "]"}], "]"}]}], 
     "]"}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.721549542592704*^9, 3.721549583905021*^9}},
 EmphasizeSyntaxErrors->True],

Cell[BoxData[
 TemplateBox[{
  "Syntax","bktmop",
   "\"Expression \\\"\\!\\(\\*RowBox[{RowBox[{RowBox[{RowBox[{\\\"Module\\\", \
\\\"[\\\", RowBox[{RowBox[{\\\"{\\\", RowBox[{RowBox[{\\\"k\\\", \\\"=\\\", \
RowBox[{\\\"k\\\", \\\"[\\\", \\\"template1\\\", \\\"]\\\"}]}], \\\",\\\", \
RowBox[{\\\"rawTemplate1\\\", \\\"=\\\", RowBox[{\\\"RawCore\\\", \\\"[\\\", \
RowBox[{\\\"templateCore\\\", \\\"[\\\", \\\"template1\\\", \\\"]\\\"}], \
\\\"]\\\"}]}], \\\",\\\", RowBox[{\\\"rawTemplate2\\\", \\\"=\\\", RowBox[{\\\
\"RawCore\\\", \\\"[\\\", RowBox[{\\\"templateCore\\\", \\\"[\\\", \
\\\"template2\\\", \\\"]\\\"}], \\\"]\\\"}]}], \\\",\\\", \
\\\"templateVars\\\"}], \\\"}\\\"}], \\\",\\\", \
RowBox[{RowBox[{\\\"templateVars\\\", \\\"=\\\", RowBox[{\\\"SortBy\\\", \
\\\"[\\\", RowBox[{RowBox[{\\\"Union\\\", \\\"[\\\", RowBox[{\\\"Flatten\\\", \
\\\"[\\\", RowBox[{RowBox[{RowBox[{RowBox[{\\\"TemplateCoreVars\\\", \
\\\"[\\\", \\\"#\\\", \\\"]\\\"}], \\\"&\\\"}], \\\"/@\\\", \
RowBox[{\\\"{\\\", RowBox[{\\\"rawTemplate1\\\", \\\",\\\", \
\\\"rawTemplate2\\\"}], \\\"}\\\"}]}], \\\",\\\", \\\"1\\\"}], \\\"]\\\"}], \
\\\"]\\\"}], \\\",\\\", RowBox[{RowBox[{\\\"FromDigits\\\", \\\"[\\\", \
RowBox[{\\\"StringDrop\\\", \\\"[\\\", RowBox[{RowBox[{\\\"SymbolName\\\", \\\
\"[\\\", \\\"#\\\", \\\"]\\\"}], \\\",\\\", \\\"1\\\"}], \\\"]\\\"}], \\\"]\\\
\"}], \\\"&\\\"}]}], \\\"]\\\"}]}], \\\";\\\", RowBox[{\\\"baseCore\\\", \
\\\"=\\\", RowBox[{\\\"BaseTemplateCore\\\", \\\"[\\\", RowBox[{RowBox[{\\\"k\
\\\", \\\"[\\\", \\\"template1\\\", \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"r\\\", \\\"[\\\", \\\"template1\\\", \\\"]\\\"}]}], \
\\\"]\\\"}]}]}]}], \\\"]\\\"}], \\\";\\\"}], \\\"\\\\n\\\", \
RowBox[{RowBox[{\\\"symbols\\\", \\\"=\\\", RowBox[{\\\"\[LeftSkeleton]\\\", \
\\\"1\\\", \\\"\[RightSkeleton]\\\"}]}], \\\";\\\"}], \\\"\\\\n\\\", \
RowBox[{RowBox[{RowBox[{\\\"\[LeftSkeleton]\\\", \\\"9\\\", \\\"\
\[RightSkeleton]\\\"}], \\\"=\\\", RowBox[{\\\"\[LeftSkeleton]\\\", \
\\\"1\\\", \\\"\[RightSkeleton]\\\"}]}], \\\";\\\"}], \\\"\[IndentingNewLine]\
\\\", RowBox[{\\\"If\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"ModIntersectionNeededQ\\\", \\\"[\\\", \
RowBox[{\\\"template1\\\", \\\",\\\", \\\"template2\\\"}], \\\"]\\\"}], \\\",\
\\\", RowBox[{\\\"Quiet\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Solve\\\", \
\\\"[\\\", RowBox[{RowBox[{\\\"Union\\\", \\\"[\\\", RowBox[{\\\"\
\[LeftSkeleton]\\\", \\\"1\\\", \\\"\[RightSkeleton]\\\"}], \\\"]\\\"}], \
\\\",\\\", RowBox[{\\\"Reverse\\\", \\\"[\\\", \\\"templateVars\\\", \
\\\"]\\\"}]}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Modulus\\\", \\\"\[Rule]\\\
\", \\\"k\\\"}]}], \\\"]\\\"}], \\\",\\\", RowBox[{\\\"Quiet\\\", \\\"[\\\", \
RowBox[{\\\"Solve\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Union\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"EquationSystem\\\", \\\"[\\\", RowBox[{\\\"rawTemplate1\\\
\", \\\",\\\", \\\"rawTemplate2\\\"}], \\\"]\\\"}], \\\",\\\", \
RowBox[{\\\"EquationSystem\\\", \\\"[\\\", RowBox[{\\\"rawTemplate1\\\", \
\\\",\\\", \\\"baseCore\\\"}], \\\"]\\\"}], \\\",\\\", \\\"equationK\\\"}], \
\\\"]\\\"}], \\\",\\\", \\\"templateVars\\\"}], \\\"]\\\"}], \\\"]\\\"}]}], \
\\\"]\\\"}]}], \\\"]\\\"}]\\)\\\" has no opening \
\\\"\\!\\(\\*RowBox[{\\\"\\\\\\\"[\\\\\\\"\\\"}]\\)\\\"\\!\\(\\*RowBox[{\\\"\\\
\\\\\"\\\\\\\"\\\"}]\\).\"",2,7,21,29442932594994200291,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.7215495867021055`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Solve", "[", 
  RowBox[{"{", 
   RowBox[{"True", ",", 
    RowBox[{"1", "\[Equal]", "x0"}], ",", 
    RowBox[{"1", "\[Equal]", 
     RowBox[{"Mod", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "1"}], "+", "y3"}], ",", "2"}], "]"}]}], ",", 
    RowBox[{"x1", "\[Equal]", "y1"}], ",", 
    RowBox[{"x2", "\[Equal]", "y2"}], ",", 
    RowBox[{"x3", "\[Equal]", "y3"}], ",", 
    RowBox[{"x0", "\[GreaterEqual]", "0"}], ",", 
    RowBox[{"x1", "\[GreaterEqual]", "0"}], ",", 
    RowBox[{"x2", "\[GreaterEqual]", "0"}], ",", 
    RowBox[{"x3", "\[GreaterEqual]", "0"}], ",", 
    RowBox[{"x0", "<", "2"}], ",", 
    RowBox[{"x1", "<", "2"}], ",", 
    RowBox[{"x2", "<", "2"}], ",", 
    RowBox[{"x3", "<", "2"}]}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.721550752866514*^9, 3.7215507544603996`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"x0", "\[Rule]", 
     RowBox[{"ConditionalExpression", "[", 
      RowBox[{"1", ",", 
       RowBox[{
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y2", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y2", "]"}], "\[Equal]", "0"}], "&&", 
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y1", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y1", "]"}], "\[Equal]", "0"}]}]}], "]"}]}], ",", 
    RowBox[{"x1", "\[Rule]", 
     RowBox[{"ConditionalExpression", "[", 
      RowBox[{"y1", ",", 
       RowBox[{
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y2", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y2", "]"}], "\[Equal]", "0"}], "&&", 
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y1", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y1", "]"}], "\[Equal]", "0"}]}]}], "]"}]}], ",", 
    RowBox[{"x2", "\[Rule]", 
     RowBox[{"ConditionalExpression", "[", 
      RowBox[{"y2", ",", 
       RowBox[{
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y2", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y2", "]"}], "\[Equal]", "0"}], "&&", 
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y1", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y1", "]"}], "\[Equal]", "0"}]}]}], "]"}]}], ",", 
    RowBox[{"x3", "\[Rule]", 
     RowBox[{"ConditionalExpression", "[", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y2", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y2", "]"}], "\[Equal]", "0"}], "&&", 
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y1", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y1", "]"}], "\[Equal]", "0"}]}]}], "]"}]}], ",", 
    RowBox[{"y3", "\[Rule]", 
     RowBox[{"ConditionalExpression", "[", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y2", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y2", "]"}], "\[Equal]", "0"}], "&&", 
        RowBox[{"0", "\[LessEqual]", 
         RowBox[{"Re", "[", "y1", "]"}], "<", "2"}], "&&", 
        RowBox[{
         RowBox[{"Im", "[", "y1", "]"}], "\[Equal]", "0"}]}]}], "]"}]}]}], 
   "}"}], "}"}]], "Output",
 CellChangeTimes->{3.721550755007295*^9}]
}, Open  ]]
},
WindowSize->{1899, 997},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.0 for Microsoft Windows (64-bit) (September 21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 124, 2, 30, "Input"],
Cell[685, 24, 2096, 58, 69, "Input"],
Cell[2784, 84, 9922, 214, 240, "Input"],
Cell[12709, 300, 10642, 221, 240, "Input"],
Cell[CellGroupData[{
Cell[23376, 525, 420, 9, 30, "Input"],
Cell[23799, 536, 570, 20, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[24406, 561, 1798, 37, 30, "Input"],
Cell[26207, 600, 4855, 113, 116, "Output"]
}, Open  ]],
Cell[31077, 716, 429, 9, 30, "Input"],
Cell[CellGroupData[{
Cell[31531, 729, 859, 24, 30, "Input"],
Cell[32393, 755, 204, 3, 30, "Output"]
}, Open  ]],
Cell[32612, 761, 543, 12, 30, "Input"],
Cell[CellGroupData[{
Cell[33180, 777, 814, 23, 30, "Input"],
Cell[33997, 802, 345, 8, 30, "Output"]
}, Open  ]],
Cell[34357, 813, 929, 20, 30, "Input"],
Cell[35289, 835, 646, 14, 30, "Input"],
Cell[35938, 851, 684, 12, 30, "Input"],
Cell[36625, 865, 98, 1, 30, "Input"],
Cell[CellGroupData[{
Cell[36748, 870, 840, 21, 50, "Input"],
Cell[37591, 893, 151, 3, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[37779, 901, 420, 7, 30, "Input"],
Cell[38202, 910, 705, 20, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[38944, 935, 120, 2, 30, "Input"],
Cell[39067, 939, 6794, 126, 164, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[45898, 1070, 627, 12, 30, "Input"],
Cell[46528, 1084, 925, 20, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[47490, 1109, 517, 11, 30, "Input"],
Cell[48010, 1122, 424, 9, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[48471, 1136, 269, 5, 30, "Input"],
Cell[48743, 1143, 784, 20, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[49564, 1168, 225, 4, 30, "Input"],
Cell[49792, 1174, 695, 16, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[50524, 1195, 441, 10, 30, "Input"],
Cell[50968, 1207, 1358, 21, 23, "Message"],
Cell[52329, 1230, 870, 15, 23, "Message"],
Cell[53202, 1247, 661, 15, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[53900, 1267, 1024, 23, 30, "Input"],
Cell[54927, 1292, 4075, 101, 69, "Output"]
}, Open  ]],
Cell[59017, 1396, 96, 1, 30, "Input"],
Cell[59116, 1399, 1861, 49, 69, "Input"],
Cell[CellGroupData[{
Cell[61002, 1452, 998, 26, 30, "Input"],
Cell[62003, 1480, 7064, 168, 154, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[69104, 1653, 680, 15, 50, "Input"],
Cell[69787, 1670, 462, 12, 30, "Output"],
Cell[70252, 1684, 462, 12, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[70751, 1701, 743, 18, 30, "Input"],
Cell[71497, 1721, 428, 10, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[71962, 1736, 1441, 36, 30, "Input"],
Cell[73406, 1774, 654, 17, 30, "Output"]
}, Open  ]],
Cell[74075, 1794, 1768, 41, 53, "Input"],
Cell[CellGroupData[{
Cell[75868, 1839, 677, 10, 30, "Input"],
Cell[76548, 1851, 808, 11, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[77393, 1867, 2336, 64, 30, "Input"],
Cell[79732, 1933, 316, 5, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[80085, 1943, 807, 19, 50, "Input"],
Cell[80895, 1964, 1101, 26, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[82033, 1995, 1459, 33, 30, "Input"],
Cell[83495, 2030, 799, 20, 30, "Output"]
}, Open  ]],
Cell[84309, 2053, 3606, 93, 164, "Input"],
Cell[CellGroupData[{
Cell[87940, 2150, 956, 21, 30, "Input"],
Cell[88899, 2173, 245, 5, 30, "Output"]
}, Open  ]],
Cell[89159, 2181, 328, 8, 30, "Input"],
Cell[89490, 2191, 136, 3, 30, "Input"],
Cell[89629, 2196, 137, 3, 30, "Output"],
Cell[CellGroupData[{
Cell[89791, 2203, 871, 19, 30, "Input"],
Cell[90665, 2224, 129, 2, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[90831, 2231, 1520, 35, 30, "Input"],
Cell[92354, 2268, 490, 8, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[92881, 2281, 2474, 45, 30, "Input"],
Cell[95358, 2328, 4940, 92, 50, "Output"]
}, Open  ]],
Cell[100313, 2423, 3684, 86, 126, "Input"],
Cell[104000, 2511, 94, 1, 30, "Input"],
Cell[CellGroupData[{
Cell[104119, 2516, 1375, 33, 49, "Input"],
Cell[105497, 2551, 598, 11, 21, "Message"],
Cell[106098, 2564, 1227, 29, 30, "Output"]
}, Open  ]],
Cell[107340, 2596, 416, 9, 30, "Input"],
Cell[107759, 2607, 149, 2, 30, "Output"],
Cell[107911, 2611, 479, 14, 30, "Input"],
Cell[CellGroupData[{
Cell[108415, 2629, 300, 7, 30, "Input"],
Cell[108718, 2638, 189, 3, 30, "Output"]
}, Open  ]],
Cell[108922, 2644, 2500, 56, 107, "Input"],
Cell[CellGroupData[{
Cell[111447, 2704, 460, 12, 32, "Input"],
Cell[111910, 2718, 128, 2, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[112075, 2725, 146, 3, 30, "Input"],
Cell[112224, 2730, 99, 1, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[112360, 2736, 457, 13, 30, "Input"],
Cell[112820, 2751, 102, 1, 30, "Output"]
}, Open  ]],
Cell[112937, 2755, 2076, 56, 197, "Input"],
Cell[CellGroupData[{
Cell[115038, 2815, 768, 20, 30, "Input"],
Cell[115809, 2837, 421, 9, 21, "Message"],
Cell[116233, 2848, 440, 11, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[116710, 2864, 753, 20, 30, "Input"],
Cell[117466, 2886, 250, 6, 21, "Message"],
Cell[117719, 2894, 934, 31, 30, "Output"]
}, Open  ]],
Cell[118668, 2928, 943, 23, 108, "Input"],
Cell[CellGroupData[{
Cell[119636, 2955, 3609, 97, 164, "Input"],
Cell[123248, 3054, 3422, 50, 110, "Message"]
}, Open  ]],
Cell[CellGroupData[{
Cell[126707, 3109, 840, 21, 30, "Input"],
Cell[127550, 3132, 2580, 65, 69, "Output"]
}, Open  ]]
}
]
*)

