(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     64902,       1639]
NotebookOptionsPosition[     62503,       1558]
NotebookOutlinePosition[     62849,       1573]
CellTagsIndexPosition[     62806,       1570]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"<<", "CATemplates`"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ChangeSymbols", "[", "core_List", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"newCore", "=", "core"}], ",", 
      RowBox[{"coreSymbols", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"core", ",", "#"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "1"}], "&"}]}],
              "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", 
         RowBox[{"DeleteDuplicates", "[", 
          RowBox[{"Select", "[", 
           RowBox[{"core", ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "0"}], "&&", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "0", "]"}], "]"}], "===", "Symbol"}]}], "&"}]}], 
           "]"}], "]"}]}], "]"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "\[LessEqual]", 
        RowBox[{"Length", "[", "coreSymbols", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", 
       RowBox[{"newCore", "=", 
        RowBox[{"(", 
         RowBox[{"newCore", "/.", 
          RowBox[{
           RowBox[{"core", "[", 
            RowBox[{"[", 
             RowBox[{"coreSymbols", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "\[Rule]", 
           RowBox[{"Symbol", "[", 
            RowBox[{"\"\<x\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{
               RowBox[{"Length", "[", "core", "]"}], "-", 
               RowBox[{"coreSymbols", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], "]"}]}]}], 
         ")"}]}]}], "]"}], ";", "\[IndentingNewLine]", "newCore"}]}], 
   "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Problema", ":", 
     RowBox[{
     "Nome", " ", "das", " ", "vari\[AAcute]veis", " ", "s\[ATilde]o", " ", 
      "muito", " ", "importantes", " ", "para", " ", "correto", " ", 
      "funcionando"}]}], ",", 
    RowBox[{
    "mas", " ", "essa", " ", "depend\[EHat]ncia", " ", "n\[ATilde]o", " ", 
     "deveria", " ", "existis"}]}], "*)"}], 
  RowBox[{
   RowBox[{"ComplementaryTest", "[", "template1_Association", "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"baseTemplate", "=", 
       RowBox[{"BaseTemplateCore", "[", 
        RowBox[{
         RowBox[{"k", "[", "template1", "]"}], ",", 
         RowBox[{"r", "[", "template1", "]"}]}], "]"}]}], "}"}], ",", " ", 
     RowBox[{
      RowBox[{"complementEquation", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "&"}], "/@", 
             RowBox[{"Map", "[", 
              RowBox[{"(*", 
               RowBox[{
               "Iguala", " ", "cada", " ", "campo", " ", "calculado", " ", 
                "ao", " ", "MOD", " ", "respectivo", " ", "para", " ", 
                "realizar", " ", "a", " ", "nega\[CCedilla]\[ATilde]o", " ", 
                "do", " ", "valor", " ", "da", " ", 
                "equa\[CCedilla]\[ATilde]o"}], "*)"}], 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Part", "[", 
                  RowBox[{"#", ",", "1"}], "]"}], "\[Equal]", 
                 RowBox[{"Mod", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Part", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "+", "w"}], ",", 
                   RowBox[{"k", "[", "template1", "]"}]}], "]"}]}], "&"}], 
               ",", 
               RowBox[{"Select", "[", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{
                  "Filtra", " ", "somente", " ", "as", " ", 
                   "posi\[CCedilla]\[OTilde]es", " ", "calculadas", " ", "do",
                    " ", "template"}], ",", 
                  RowBox[{
                  "ignorando", " ", "vari\[AAcute]veis", " ", "livres"}]}], 
                 "*)"}], 
                RowBox[{
                 RowBox[{"MapThread", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#1", "===", "#2"}], ",", "\"\<X\>\"", ",", 
                    RowBox[{"#1", "\[Equal]", "#2"}]}], "]"}], "&"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ChangeSymbols", "[", 
                    RowBox[{"BaseTemplateCore", "[", 
                    RowBox[{
                    RowBox[{"k", "[", "template1", "]"}], ",", 
                    RowBox[{"r", "[", "template1", "]"}]}], "]"}], "]"}], ",", 
                    RowBox[{"ChangeSymbols", "[", 
                    RowBox[{"templateCore", "[", "template1", "]"}], "]"}]}], 
                    "}"}]}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"Not", "[", 
                   RowBox[{"#", "===", "\"\<X\>\""}], "]"}], "&"}]}], "]"}]}],
               "]"}]}], ")"}], "/.", 
           RowBox[{"w", "\[Rule]", "#"}]}], " ", 
          RowBox[{"(*", 
           RowBox[{
           "Substitu\[IAcute]", " ", "a", " ", "vari\[AAcute]vel", " ", "w", 
            " ", "pelo", " ", "valor", " ", "respectivo", " ", "da", " ", 
            "iterea\[CCedilla]\[ATilde]o", " ", "do", " ", "MOD"}], "*)"}], 
          ")"}], "&"}], "/@", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Mapeia", " ", "cada", " ", "campo", " ", "calculado", " ", "com", 
           " ", "a", " ", "itera\[CCedilla]\[ATilde]o", " ", "de", " ", "1", 
           " ", "\[AGrave]", " ", "k"}], "-", 
          RowBox[{
          "1", " ", "para", " ", "realizar", " ", "a", " ", 
           "opera\[CCedilla]\[ATilde]o", " ", "de", " ", "MOD", " ", "da", 
           " ", "nega\[CCedilla]\[ATilde]o"}]}], "*)"}], 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{
           RowBox[{"k", "[", "template1", "]"}], "-", "1"}]}], "]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"listaComplemento", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"listaComplemento", ",", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", "\[Equal]", " ", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", "\[Equal]", 
                  " ", "2"}], ",", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "\[Equal]", 
               " ", 
               RowBox[{"(", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ")"}]}], ",", " ", 
              RowBox[{"-", "1"}], ",", " ", 
              RowBox[{"Evaluate", "[", " ", 
               RowBox[{"Part", "[", 
                RowBox[{"#", ",", " ", "2"}], "]"}], "]"}]}], "]"}]}], " ", 
           "&"}], " ", ",", " ", 
          RowBox[{"complementEquation", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}], ";", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"e", " ", "=", " ", "2"}], ",", " ", 
        RowBox[{"e", " ", "\[LessEqual]", " ", 
         RowBox[{"Length", "[", "complementEquation", "]"}]}], ",", " ", 
        RowBox[{"e", "++"}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"listaComplemento", ",", " ", 
          RowBox[{"complementEquation", "[", 
           RowBox[{"[", "e", "]"}], "]"}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "listaComplemento"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7213119391967325`*^9, 3.7213119490152736`*^9}, 
   3.721315368814711*^9, {3.72131635172103*^9, 3.7213163754431705`*^9}, {
   3.721316442647564*^9, 3.7213165188606234`*^9}, {3.7213166022121687`*^9, 
   3.721316605003888*^9}, {3.7213166421627436`*^9, 3.721316692567815*^9}, {
   3.7213168375453367`*^9, 3.7213168384115353`*^9}, {3.721317141398978*^9, 
   3.72131717262553*^9}, {3.721317295855425*^9, 3.7213173489581857`*^9}, {
   3.721317440134726*^9, 3.721317489124405*^9}, {3.721317521238695*^9, 
   3.721317521727817*^9}, {3.7213175646389484`*^9, 3.721317565160084*^9}, {
   3.721317605059384*^9, 3.721317609546545*^9}, {3.721317641855908*^9, 
   3.721317725976706*^9}, {3.7213178675193386`*^9, 3.72131787069316*^9}, {
   3.7213179760094423`*^9, 3.721318051934579*^9}, {3.7213180979174805`*^9, 
   3.721318216004017*^9}, {3.7213182593742676`*^9, 3.7213183462302866`*^9}, {
   3.7213183917600803`*^9, 3.721318401416569*^9}, 3.7213184518556085`*^9, {
   3.721318507827112*^9, 3.721318509494525*^9}, {3.7213190483623037`*^9, 
   3.721319101121932*^9}, {3.721319150754806*^9, 3.721319222595502*^9}, {
   3.7213195561994905`*^9, 3.7213197899789944`*^9}, {3.7213198652264967`*^9, 
   3.7213198987401447`*^9}, {3.7213199347724943`*^9, 3.721319981086483*^9}, {
   3.7213207486355677`*^9, 3.7213207552582808`*^9}, {3.721320788105912*^9, 
   3.721320799448848*^9}, {3.721320852136484*^9, 3.721320853735899*^9}, {
   3.7213213425258017`*^9, 3.721321432604127*^9}, {3.721321524599275*^9, 
   3.721321527927408*^9}, {3.7213216050919495`*^9, 3.721321693558357*^9}, {
   3.7213217587806363`*^9, 3.7213218215381737`*^9}, {3.72132186764772*^9, 
   3.721321939598983*^9}, {3.7213413240642242`*^9, 3.7213413571907434`*^9}, {
   3.721342400431984*^9, 3.7213424061324854`*^9}, 3.7213461594355516`*^9, {
   3.721346322985114*^9, 3.7213463687858973`*^9}, {3.721346446442734*^9, 
   3.7213464612650046`*^9}}],

Cell[BoxData[")"], "Input",
 CellChangeTimes->{3.721319650209834*^9}],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{"OperacaoDiferenca", "[", 
    RowBox[{"template1_Association", ",", "template2_Association"}], "]"}], 
   " ", ":=", " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"complementaryTemplate", " ", "=", " ", 
       RowBox[{"ComplementaryTest", "[", "template2", "]"}]}], " ", "}"}], 
     ",", 
     RowBox[{
      RowBox[{"totalItems", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "complementaryTemplate", "]"}], " ", ">", 
           " ", "0"}], " ", "&&", " ", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"complementaryTemplate", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", ">", " ", "0"}]}], 
         ",", "  ", 
         RowBox[{"Length", "[", 
          RowBox[{"complementaryTemplate", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", "0"}], "]"}]}], 
      ";", 
      RowBox[{"lista", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", " ", 
      RowBox[{"templates", " ", "=", 
       RowBox[{"{", "}"}]}], ";", " ", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"u", "=", "1"}], ",", 
        RowBox[{"u", "\[LessEqual]", "totalItems"}], ",", 
        RowBox[{"u", "++"}], ",", " ", 
        RowBox[{"AppendTo", "[", " ", 
         RowBox[{"lista", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "u", "]"}], "]"}], " ", "&"}], " ", "/@", "  ", 
           "complementaryTemplate"}]}], "]"}]}], "]"}], ";", " ", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"v", "=", "1"}], ",", 
        RowBox[{"v", "\[LessEqual]", 
         RowBox[{"Length", "[", "lista", "]"}]}], ",", 
        RowBox[{"v", "++"}], ",", " ", 
        RowBox[{"AppendTo", "[", " ", 
         RowBox[{"templates", ",", " ", 
          RowBox[{"BuildTemplate", "[", 
           RowBox[{
            RowBox[{"k", "[", "template1", "]"}], ",", 
            RowBox[{"r", "[", "template1", "]"}], ",", " ", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"#", " ", "===", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"lista", "[", 
                    RowBox[{"[", "v", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", "&"}], " ", "/@", 
                   " ", 
                   RowBox[{"lista", "[", 
                    RowBox[{"[", "v", "]"}], "]"}]}], ")"}], " ", ",", "#"}], 
                "]"}], " ", "&"}], ",", 
              RowBox[{"BaseTemplateCore", "[", 
               RowBox[{
                RowBox[{"k", "[", "template1", "]"}], ",", 
                RowBox[{"r", "[", "template1", "]"}]}], "]"}]}], "]"}]}], 
           "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"coreList", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"t", "=", "1"}], ",", 
        RowBox[{"t", "\[LessEqual]", 
         RowBox[{"Length", "[", "lista", "]"}]}], ",", 
        RowBox[{"t", "++"}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"coreList", ",", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"#", " ", "===", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"lista", "[", 
                   RowBox[{"[", "t", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"templateCore", "[", "template1", "]"}], "[", 
                  RowBox[{"[", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"BaseTemplateCore", "[", 
                    RowBox[{
                    RowBox[{"k", "[", "template1", "]"}], ",", 
                    RowBox[{"r", "[", "template1", "]"}]}], "]"}], ",", " ", 
                    "#"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ")"}], " ", 
                "\[Element]", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", "&"}], " ", "/@", 
                  " ", 
                  RowBox[{"lista", "[", 
                   RowBox[{"[", "t", "]"}], "]"}]}], ")"}]}], ",", " ", 
               RowBox[{
                RowBox[{"templateCore", "[", "template1", "]"}], "[", 
                RowBox[{"[", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"BaseTemplateCore", "[", 
                    RowBox[{
                    RowBox[{"k", "[", "template1", "]"}], ",", 
                    RowBox[{"r", "[", "template1", "]"}]}], "]"}], ",", " ", 
                    "#"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}], " ", 
             "&"}], ",", 
            RowBox[{"BaseTemplateCore", "[", 
             RowBox[{
              RowBox[{"k", "[", "template1", "]"}], ",", 
              RowBox[{"r", "[", "template1", "]"}]}], "]"}]}], "]"}]}], 
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"BuildTemplate", "[", 
         RowBox[{
          RowBox[{"k", "[", "template1", "]"}], ",", 
          RowBox[{"r", "[", "template1", "]"}], ",", " ", "#", ",", " ", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"DeleteDuplicates", "[", " ", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"postExpansionFn", "[", "template1", "]"}], ",", 
                "FilterNotAllowed"}], "}"}], "]"}], "]"}], ",", " ", 
            RowBox[{
             RowBox[{"#", " ", "=!=", " ", "IdentityFn"}], " ", "&"}]}], 
           "]"}]}], "]"}], " ", "&"}], " ", "/@", " ", "coreList"}]}]}], 
    "\[IndentingNewLine]", " ", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7213119521410832`*^9, 3.7213119938172026`*^9}, {
   3.7213122216011415`*^9, 3.721312232926076*^9}, {3.7213122639891276`*^9, 
   3.7213123988990326`*^9}, {3.72131248719991*^9, 3.721312512758512*^9}, {
   3.7213125451480536`*^9, 3.7213125609132757`*^9}, {3.721312591150812*^9, 
   3.7213126548330717`*^9}, {3.721312970879241*^9, 3.7213130648785405`*^9}, {
   3.7213131063512897`*^9, 3.7213131694686213`*^9}, {3.721313225815222*^9, 
   3.721313266253688*^9}, {3.7213133128667383`*^9, 3.721313383414012*^9}, {
   3.721313513784728*^9, 3.721313624247341*^9}, {3.721313764184534*^9, 
   3.7213138743954067`*^9}, {3.721314075610896*^9, 3.721314206837831*^9}, {
   3.7213142369641485`*^9, 3.721314241136036*^9}, {3.721314396246498*^9, 
   3.7213145262025986`*^9}, {3.7213145839978504`*^9, 3.721314859048499*^9}, {
   3.721314939376568*^9, 3.7213149818395433`*^9}, 3.7213150244585876`*^9, {
   3.721315081378319*^9, 3.7213151340839596`*^9}, {3.7213151824944897`*^9, 
   3.7213152813810816`*^9}, {3.7213161698899713`*^9, 3.721316236314162*^9}, {
   3.7213168859358363`*^9, 3.7213168865550213`*^9}, 3.7213188353268776`*^9, {
   3.721318866275879*^9, 3.7213188808826575`*^9}, {3.7213192685690656`*^9, 
   3.721319296783377*^9}, {3.7213193634076195`*^9, 3.721319452148559*^9}, 
   3.721319537944765*^9, {3.7213220167123795`*^9, 3.7213220483938336`*^9}, {
   3.7213220985621223`*^9, 3.7213221712416506`*^9}, {3.721322244817705*^9, 
   3.7213222454583535`*^9}, {3.7213224011274004`*^9, 
   3.7213224779976263`*^9}, {3.7213225203779593`*^9, 3.721322553109516*^9}, {
   3.7213393962453184`*^9, 3.7213394040063267`*^9}, {3.721339461590233*^9, 
   3.721339510117764*^9}, {3.7213395943265843`*^9, 3.721339594969751*^9}, {
   3.721339675018496*^9, 3.7213397055233765`*^9}, {3.721339747112155*^9, 
   3.7213397861932697`*^9}, {3.721339821699444*^9, 3.7213398494336157`*^9}, {
   3.7213399235229163`*^9, 3.7213400184724855`*^9}, {3.7213402364539075`*^9, 
   3.721340252081952*^9}, 3.7213404581702857`*^9, {3.721340539686388*^9, 
   3.7213405402785425`*^9}, {3.7213405939534063`*^9, 3.7213406693207073`*^9}, 
   3.7213407490958586`*^9, {3.721340942558793*^9, 3.7213410142452097`*^9}, {
   3.72134112284529*^9, 3.721341128876816*^9}, {3.721341208755462*^9, 
   3.7213412295520935`*^9}, {3.721341656635338*^9, 3.721341657238948*^9}, {
   3.7213451890129395`*^9, 3.7213452163150067`*^9}, {3.721345482646339*^9, 
   3.7213454870405025`*^9}, {3.721345528561221*^9, 3.72134553610419*^9}, {
   3.72134558258738*^9, 3.721345643134959*^9}, {3.72134583747534*^9, 
   3.7213458863376026`*^9}, {3.7213465366423945`*^9, 3.7213465432837853`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Map", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"#", " ", "===", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x0", " ", "==", " ", "1"}], ",", " ", 
           RowBox[{"x0", " ", "==", " ", "2"}]}], "}"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
      RowBox[{"#", " ", "\[Element]", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", "&"}], " ", "/@", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x0", " ", "==", " ", "1"}], ",", " ", 
           RowBox[{"x0", " ", "==", " ", "2"}]}], "}"}]}], ")"}]}], " ", ",", 
      "#"}], "]"}], " ", "&"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "x8", ",", "x7", ",", "x6", ",", "x5", ",", "x4", ",", "x3", ",", "x2", 
     ",", "x1", ",", "x0"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7213155634490824`*^9, 3.7213155645123577`*^9}, {
  3.721315645806332*^9, 3.7213156506395817`*^9}, {3.721315701192641*^9, 
  3.7213157680529428`*^9}, {3.7213158239434366`*^9, 3.721315854451318*^9}, {
  3.7213159157761893`*^9, 3.7213161159199886`*^9}, {3.7213200419702406`*^9, 
  3.7213200488160124`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "x8", ",", "x7", ",", "x6", ",", "x5", ",", "x4", ",", "x3", ",", "x2", ",",
    "x1", ",", 
   RowBox[{"x0", "\[Element]", 
    RowBox[{"{", 
     RowBox[{"1", ",", "2"}], "}"}]}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.7213155649494705`*^9, 3.7213156147192564`*^9, {3.721315761140152*^9, 
   3.7213157708196573`*^9}, 3.7213158247166185`*^9, {3.721315855007446*^9, 
   3.721315880981168*^9}, {3.721315922728986*^9, 3.721316031029003*^9}, 
   3.7213160805618234`*^9, 3.7213161216694746`*^9, 3.7213185359513865`*^9, 
   3.72132001653863*^9}]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7213160700531034`*^9, 3.721316073005895*^9}}],

Cell[BoxData[
 RowBox[{"If", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"Mod", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Part", "[", 
        RowBox[{"#", ",", "2"}], "]"}], "+", "w"}], ",", 
      RowBox[{"k", "[", "template1", "]"}]}], "]"}], " ", "==", " ", 
    RowBox[{"Part", "[", 
     RowBox[{"#", ",", "2"}], "]"}]}], ",", " ", 
   RowBox[{"-", "1"}], ",", " ", 
   RowBox[{"Mod", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Part", "[", 
       RowBox[{"#", ",", "2"}], "]"}], "+", "w"}], ",", 
     RowBox[{"k", "[", "template1", "]"}]}], "]"}]}], " ", "]"}]], "Input",
 CellChangeTimes->{{3.7213167465157776`*^9, 3.721316823966797*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Flatten", "[", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"ExpandTemplate", "[", "#", "]"}], " ", "&"}], " ", "/@", " ", 
     RowBox[{"OperacaoDiferenca", "[", 
      RowBox[{
       RowBox[{"BuildTemplate", "[", 
        RowBox[{"2", ",", " ", "0.5", ",", " ", 
         RowBox[{"{", 
          RowBox[{"x3", ",", 
           RowBox[{"x3", " ", "+", " ", "1"}], ",", "x2", ",", "x0"}], 
          "}"}]}], "]"}], ",", " ", 
       RowBox[{"BuildTemplate", "[", 
        RowBox[{"2", ",", " ", "0.5", ",", " ", 
         RowBox[{"{", 
          RowBox[{"x3", ",", "x2", ",", 
           RowBox[{"x3", " ", "+", " ", "1"}], ",", 
           RowBox[{"x3", " ", "+", " ", "1"}]}], "}"}]}], "]"}]}], "]"}]}], 
    ")"}], ",", " ", "1"}], "]"}]], "Input",
 CellChangeTimes->{
  3.7213169567871985`*^9, {3.721317085261422*^9, 3.721317099088028*^9}, {
   3.72131899415899*^9, 3.7213189999114532`*^9}, {3.7213395212826796`*^9, 
   3.7213395377359385`*^9}, {3.721341239735741*^9, 3.721341249411954*^9}, {
   3.7213413319785013`*^9, 3.7213413339368258`*^9}, {3.7213416876341085`*^9, 
   3.721341699099758*^9}, {3.7213424192668743`*^9, 3.7213424536987696`*^9}, {
   3.721342617417446*^9, 3.7213426224927597`*^9}, {3.7213442415806665`*^9, 
   3.7213443266176753`*^9}, {3.7213443656367736`*^9, 
   3.7213444042376347`*^9}, {3.721344446616602*^9, 3.721344550964605*^9}, {
   3.7213446063059063`*^9, 3.721344634278171*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "1", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1", ",", "1", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "1", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "1", ",", "1"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.721344493129626*^9, 3.7213445517568016`*^9}, {
  3.721344606773038*^9, 3.721344624134534*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ExpandTemplate", "[", 
  RowBox[{"BuildTemplate", "[", 
   RowBox[{"3", ",", " ", "0.5", ",", " ", 
    RowBox[{"{", 
     RowBox[{
     "x8", ",", "x7", ",", "x6", ",", "x5", ",", "x4", ",", "x3", ",", "x2", 
      ",", 
      RowBox[{"1", "+", "x3"}], ",", 
      RowBox[{"x0", "\[Element]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"1", "+", "x3"}], "\[Equal]", 
            RowBox[{"Mod", "[", 
             RowBox[{
              RowBox[{"1", "+", "x3"}], ",", "3"}], "]"}]}], ",", 
           RowBox[{"-", "1"}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x0", "\[Equal]", 
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"1", "+", "x3"}], ",", "3"}], "]"}]}], ")"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"2", "+", "x3"}], ",", "3"}], "]"}], ",", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"3", "+", "x3"}], ",", "3"}], "]"}]}], "}"}]}]}], "}"}], 
    ",", " ", 
    RowBox[{"{", "FilterNotAllowed", "}"}]}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7213209454156275`*^9, 3.72132097985154*^9}, {
   3.7213210137336273`*^9, 3.721321014597851*^9}, {3.721321047607387*^9, 
   3.7213210510712905`*^9}, {3.7213211257306137`*^9, 
   3.7213213031575775`*^9}, {3.7213214750920877`*^9, 
   3.7213214949829826`*^9}, {3.7213413805924463`*^9, 
   3.7213415606602287`*^9}, {3.721341621493228*^9, 3.7213416217509966`*^9}, 
   3.7213416805468383`*^9, {3.721341713262048*^9, 3.721341769542329*^9}, {
   3.7213418842634215`*^9, 3.721341899219265*^9}, {3.7213419656890707`*^9, 
   3.7213420032034774`*^9}}],

Cell[BoxData[
 TemplateBox[{
  "Part","partd",
   "\"Part specification \\!\\(\\*RowBox[{\\\"True\\\", \\\"\
\[LeftDoubleBracket]\\\", \\\"2\\\", \\\"\[RightDoubleBracket]\\\"}]\\) is \
longer than depth of object.\"",2,104,48,29441562813868201336,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.7213419675380163`*^9, {3.721342289642308*^9, 3.7213422945025797`*^9}, 
   3.7213442321112013`*^9}],

Cell[BoxData[
 TemplateBox[{
  "Part","partd",
   "\"Part specification \\!\\(\\*RowBox[{\\\"False\\\", \\\"\
\[LeftDoubleBracket]\\\", \\\"2\\\", \\\"\[RightDoubleBracket]\\\"}]\\) is \
longer than depth of object.\"",2,104,49,29441562813868201336,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.7213419675380163`*^9, {3.721342289642308*^9, 3.7213422945025797`*^9}, 
   3.7213442321421967`*^9}],

Cell[BoxData[
 TemplateBox[{
  "Part","partd",
   "\"Part specification \\!\\(\\*RowBox[{\\\"False\\\", \\\"\
\[LeftDoubleBracket]\\\", \\\"2\\\", \\\"\[RightDoubleBracket]\\\"}]\\) is \
longer than depth of object.\"",2,104,50,29441562813868201336,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.7213419675380163`*^9, {3.721342289642308*^9, 3.7213422945025797`*^9}, 
   3.7213442321561995`*^9}],

Cell[BoxData[
 TemplateBox[{
  "General","stop",
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"Part\\\", \\\"::\\\", \
\\\"partd\\\"}], \\\"MessageName\\\"]\\) will be suppressed during this \
calculation.\"",2,104,51,29441562813868201336,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.7213419675380163`*^9, {3.721342289642308*^9, 3.7213422945025797`*^9}, 
   3.721344232170207*^9}],

Cell[BoxData[
 InterpretationBox[
  TagBox[
   FrameBox[GridBox[{
      {
       ItemBox[
        TagBox[
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", 
             ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", 
             ",", "1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", 
             ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", 
             ",", "1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "2", 
             ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "2", 
             ",", "1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", 
             ",", "2", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", 
             ",", "2", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "1", 
             ",", "2", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "1", 
             ",", "2", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "2", 
             ",", "2", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "2", 
             ",", "2", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "2", ",", "0", 
             ",", "3", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "2", ",", "0", 
             ",", "3", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "2", ",", "1", 
             ",", "3", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "2", ",", "1", 
             ",", "3", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "2", ",", "2", 
             ",", "3", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "2", ",", "2", 
             ",", "3", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ",", "0", 
             ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ",", "0", 
             ",", "1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ",", "1", 
             ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ",", "1", 
             ",", "1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ",", "2", 
             ",", "1", ",", "0"}], "}"}], ",", 
           TemplateBox[{"4328"},
            "OutputSizeLimit`Skeleton",
            DisplayFunction->(FrameBox[
              RowBox[{"\" \[CenterEllipsis]\"", #, "\"\[CenterEllipsis] \""}],
               Background -> GrayLevel[0.75], 
              BaseStyle -> {
               "Deploy", FontColor -> GrayLevel[1], FontSize -> Smaller, 
                ShowStringCharacters -> False}, BaselinePosition -> Baseline, 
              ContentPadding -> False, FrameMargins -> {{1, 1}, {1, 2}}, 
              FrameStyle -> None, RoundingRadius -> 7]& )], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "1", ",", "2", ",", "0", 
             ",", "3", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "1", ",", "2", ",", "1", 
             ",", "3", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "1", ",", "2", ",", "1", 
             ",", "3", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "1", ",", "2", ",", "2", 
             ",", "3", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "1", ",", "2", ",", "2", 
             ",", "3", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "0", ",", "0", 
             ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "0", ",", "0", 
             ",", "1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "0", ",", "1", 
             ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "0", ",", "1", 
             ",", "1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "0", ",", "2", 
             ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "0", ",", "2", 
             ",", "1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "1", ",", "0", 
             ",", "2", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "1", ",", "0", 
             ",", "2", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "1", ",", "1", 
             ",", "2", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "1", ",", "1", 
             ",", "2", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "1", ",", "2", 
             ",", "2", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "1", ",", "2", 
             ",", "2", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "0", 
             ",", "3", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "0", 
             ",", "3", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "1", 
             ",", "3", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "1", 
             ",", "3", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "2", 
             ",", "3", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "2", 
             ",", "3", ",", "2"}], "}"}]}], "}"}],
         Short[#, 5]& ],
        BaseStyle->{Deployed -> False},
        StripOnInput->False]},
      {GridBox[{
         {
          TagBox[
           TooltipBox[
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource[
                "FEStrings", "sizeBriefExplanation"], StandardForm],
               ImageSizeCache->{65., {3., 9.}}],
              StripOnInput->False,
              DynamicUpdating->True], "SuggestionsBarCategory",
             StripOnInput->False],
            StyleBox[
             DynamicBox[
              ToBoxes[
               FEPrivate`FrontEndResource["FEStrings", "sizeExplanation"], 
               StandardForm]], DynamicUpdating -> True, StripOnInput -> 
             False]],
           Annotation[#, 
            Style[
             Dynamic[
              FEPrivate`FrontEndResource["FEStrings", "sizeExplanation"]], 
             DynamicUpdating -> True], "Tooltip"]& ], 
          ButtonBox[
           PaneSelectorBox[{False->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowLess"], 
                StandardForm],
               ImageSizeCache->{52., {1., 9.}}],
              StripOnInput->False,
              DynamicUpdating->True], "SuggestionsBarControl",
             StripOnInput->False], True->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowLess"], 
                StandardForm]],
              StripOnInput->False,
              DynamicUpdating->True], "SuggestionsBarControlActive",
             StripOnInput->False]}, Dynamic[
             CurrentValue["MouseOver"]],
            Alignment->Center,
            FrameMargins->0,
            ImageSize->{Automatic, 25}],
           Appearance->None,
           
           ButtonFunction:>OutputSizeLimit`ButtonFunction[
            OutputSizeLimit`Defer, 104, 29441562813868201336, 5/2],
           Enabled->True,
           Evaluator->Automatic,
           Method->"Queued"], 
          ButtonBox[
           PaneSelectorBox[{False->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowMore"], 
                StandardForm],
               ImageSizeCache->{62., {1., 9.}}],
              StripOnInput->False,
              DynamicUpdating->True], "SuggestionsBarControl",
             StripOnInput->False], True->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowMore"], 
                StandardForm],
               ImageSizeCache->{62., {1., 9.}}],
              StripOnInput->False,
              DynamicUpdating->True], "SuggestionsBarControlActive",
             StripOnInput->False]}, Dynamic[
             CurrentValue["MouseOver"]],
            Alignment->Center,
            FrameMargins->0,
            ImageSize->{Automatic, 25}],
           Appearance->None,
           
           ButtonFunction:>OutputSizeLimit`ButtonFunction[
            OutputSizeLimit`Defer, 104, 29441562813868201336, 5 2],
           Enabled->True,
           Evaluator->Automatic,
           Method->"Queued"], 
          ButtonBox[
           PaneSelectorBox[{False->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowAll"], 
                StandardForm],
               ImageSizeCache->{44., {1., 9.}}],
              StripOnInput->False,
              DynamicUpdating->True], "SuggestionsBarControl",
             StripOnInput->False], True->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowAll"], 
                StandardForm]],
              StripOnInput->False,
              DynamicUpdating->True], "SuggestionsBarControlActive",
             StripOnInput->False]}, Dynamic[
             CurrentValue["MouseOver"]],
            Alignment->Center,
            FrameMargins->0,
            ImageSize->{Automatic, 25}],
           Appearance->None,
           
           ButtonFunction:>OutputSizeLimit`ButtonFunction[
            OutputSizeLimit`Defer, 104, 29441562813868201336, Infinity],
           Enabled->True,
           Evaluator->Automatic,
           Method->"Queued"], 
          ButtonBox[
           PaneSelectorBox[{False->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeChangeLimit"], 
                StandardForm],
               ImageSizeCache->{78., {1., 9.}}],
              StripOnInput->False,
              DynamicUpdating->True], "SuggestionsBarControl",
             StripOnInput->False], True->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeChangeLimit"], 
                StandardForm]],
              StripOnInput->False,
              DynamicUpdating->True], "SuggestionsBarControlActive",
             StripOnInput->False]}, Dynamic[
             CurrentValue["MouseOver"]],
            Alignment->Center,
            FrameMargins->0,
            ImageSize->{Automatic, 25}],
           Appearance->None,
           ButtonFunction:>FrontEndExecute[{
              FrontEnd`SetOptions[
              FrontEnd`$FrontEnd, 
               FrontEnd`PreferencesSettings -> {"Page" -> "Evaluation"}], 
              FrontEnd`FrontEndToken["PreferencesDialog"]}],
           Evaluator->None,
           Method->"Preemptive"]}
        },
        AutoDelete->False,
        FrameStyle->GrayLevel[0.85],
        GridBoxDividers->{"Columns" -> {False, {True}}},
        GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}},
        GridBoxSpacings->{"Columns" -> {{2}}}]}
     },
     DefaultBaseStyle->"Column",
     GridBoxAlignment->{
      "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
       "RowsIndexed" -> {}},
     GridBoxDividers->{
      "Columns" -> {{False}}, "ColumnsIndexed" -> {}, "Rows" -> {{False}}, 
       "RowsIndexed" -> {}},
     GridBoxItemSize->{
      "Columns" -> {{Automatic}}, "ColumnsIndexed" -> {}, "Rows" -> {{1.}}, 
       "RowsIndexed" -> {}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.5599999999999999]}, 
         Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
         Offset[0.2], 
         Offset[1.2], {
          Offset[0.4]}, 
         Offset[0.2]}, "RowsIndexed" -> {}}],
    Background->RGBColor[0.9657, 0.9753, 0.9802],
    FrameMargins->{{12, 12}, {0, 15}},
    FrameStyle->GrayLevel[0.85],
    RoundingRadius->5,
    StripOnInput->False],
   Deploy,
   DefaultBaseStyle->"Deploy"],
  Out[104]]], "Output",
 CellChangeTimes->{{3.7213209549370627`*^9, 3.721321014985924*^9}, {
   3.7213210480514936`*^9, 3.721321051395347*^9}, {3.7213211393111*^9, 
   3.7213211808419085`*^9}, {3.7213212126332073`*^9, 
   3.7213212538552284`*^9}, {3.7213212872351284`*^9, 
   3.7213213038138275`*^9}, {3.721321448930138*^9, 3.721321495904848*^9}, 
   3.7213413813808675`*^9, {3.7213414455523753`*^9, 3.7213415645665035`*^9}, 
   3.7213416228890705`*^9, 3.721341683864313*^9, {3.721341732224393*^9, 
   3.721341771699729*^9}, 3.721341891341872*^9, {3.7213419575581827`*^9, 
   3.721341968142803*^9}, {3.721342290320483*^9, 3.7213422951717386`*^9}, 
   3.7213442328043795`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["\[Element]"], "Input",
 CellChangeTimes->{{3.7213211542564416`*^9, 3.721321154381442*^9}, {
  3.7213401903339615`*^9, 3.721340225307022*^9}, {3.721340380266128*^9, 
  3.721340394638849*^9}, {3.7213407009336023`*^9, 3.721340743783555*^9}, {
  3.7213408473166285`*^9, 3.7213409355517178`*^9}, {3.7213409708549266`*^9, 
  3.7213409731880913`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", "9", "}"}], "}"}]], "Output",
 CellChangeTimes->{{3.7213409234589696`*^9, 3.7213409358954563`*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ListasIguais", "[", 
   RowBox[{"lista1_List", ",", " ", "lista2_List"}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Sort", "[", "lista1", "]"}], " ", "===", " ", 
   RowBox[{"Sort", "[", "lista2", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7213423691269083`*^9, 3.7213423912486334`*^9}, {
  3.721342650056893*^9, 3.721342701491232*^9}, {3.7213433056726265`*^9, 
  3.7213433212846947`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ListasIguais", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "2"}], "}"}]}], "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "1"}], "}"}]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.721342703461734*^9, 3.72134271936383*^9}, {
  3.7213433262479787`*^9, 3.721343349250932*^9}}],

Cell[BoxData["False"], "Output",
 CellChangeTimes->{{3.7213427156738873`*^9, 3.7213427198829794`*^9}, {
   3.721343323747304*^9, 3.7213433500311193`*^9}, 3.7213467361932507`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ListasDiferenca", "[", 
   RowBox[{"lista1_List", ",", " ", "lista2_List"}], "]"}], " ", ":=", " ", 
  RowBox[{"Select", "[", 
   RowBox[{"lista1", ",", 
    RowBox[{
     RowBox[{"ContainsNone", "[", 
      RowBox[{"lista2", ",", " ", 
       RowBox[{"{", "#", "}"}]}], "]"}], " ", "&"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7213435193834763`*^9, 3.7213436950307407`*^9}, {
   3.7213440159182568`*^9, 3.7213440565397635`*^9}, {3.721344113969632*^9, 
   3.7213441226698923`*^9}, 3.721344703361226*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ListasDiferenca", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "2"}], "}"}]}], "}"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
       "1", ",", "1"}], "}"}]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{3.7213437048549805`*^9, 3.7213447076253242`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
   "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", 
    ",", "2"}], "}"}], "}"}]], "Output",
 CellChangeTimes->{
  3.7213437051674733`*^9, {3.7213440596475935`*^9, 3.7213440720947742`*^9}, 
   3.721344124942453*^9, 3.721344708077449*^9, 3.7213467449873486`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ExpandirOperacaoDiferenca", "[", 
   RowBox[{"template1_Association", ",", "template2_Association"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"DeleteDuplicates", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"ExpandTemplate", "[", "#", "]"}], " ", "&"}], " ", "/@", " ", 
       RowBox[{"OperacaoDiferenca", "[", 
        RowBox[{"template1", ",", " ", "template2"}], "]"}]}], ")"}], ",", 
     " ", "1"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7213438148462*^9, 3.7213438202836018`*^9}, {
   3.7213438528470507`*^9, 3.721343863911915*^9}, {3.7213439222240143`*^9, 
   3.7213439867186947`*^9}, {3.721344142312975*^9, 3.7213441684287205`*^9}, 
   3.721344222617734*^9, {3.7213446473085165`*^9, 3.7213446741746664`*^9}, {
   3.721344955049387*^9, 3.721344958384242*^9}, {3.7213451024265037`*^9, 
   3.721345115174814*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"TestarOperacaoDiferenca", "[", 
   RowBox[{"template1_Association", ",", "template2_Association"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"ListasIguais", "[", 
   RowBox[{
    RowBox[{"ListasDiferenca", "[", 
     RowBox[{
      RowBox[{"ExpandTemplate", "[", "template1", "]"}], ",", " ", 
      RowBox[{"ExpandTemplate", "[", "template2", "]"}]}], "]"}], ",", " ", 
    RowBox[{"ExpandirOperacaoDiferenca", "[", 
     RowBox[{"template1", ",", " ", "template2"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7213446804493046`*^9, 3.721344693210619*^9}, {
  3.7213447236735044`*^9, 3.721344788961403*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"TestarOperacaoDiferenca", "[", 
  RowBox[{
   RowBox[{"ColorBlindTemplate", "[", 
    RowBox[{"3", ",", " ", "0.5"}], "]"}], ",", " ", 
   RowBox[{"StateConservingTemplate", "[", 
    RowBox[{"3", ",", " ", "0.5"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7213447911049433`*^9, 3.72134480545467*^9}, {
  3.721344968948984*^9, 3.721344978151353*^9}, {3.72134593360058*^9, 
  3.7213459834608545`*^9}, {3.721346069190419*^9, 3.7213460734404297`*^9}, {
  3.7213465725759115`*^9, 3.7213465991507187`*^9}}],

Cell[BoxData["False"], "Output",
 CellChangeTimes->{
  3.721344809454693*^9, {3.721344963624591*^9, 3.721344978550454*^9}, 
   3.7213451179505224`*^9, 3.7213459290206995`*^9, 3.721345984163955*^9, 
   3.7213460580656157`*^9, 3.7213464092779446`*^9, 3.7213464726224413`*^9, {
   3.721346550423997*^9, 3.721346599635104*^9}, 3.7213467495185976`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Sort", "[", 
  RowBox[{"ExpandirOperacaoDiferenca", "[", " ", 
   RowBox[{
    RowBox[{"ColorBlindTemplate", "[", 
     RowBox[{"3", ",", " ", "0.5"}], "]"}], ",", " ", 
    RowBox[{"StateConservingTemplate", "[", 
     RowBox[{"3", ",", " ", "0.5"}], "]"}]}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7213460782817497`*^9, 3.721346129153633*^9}, {
   3.7213461849545126`*^9, 3.72134618556564*^9}, {3.721346380725591*^9, 
   3.7213464351312785`*^9}, 3.7213465100685873`*^9, 3.721346569599496*^9, {
   3.7213466041037264`*^9, 3.721346608850479*^9}, {3.721346862118681*^9, 
   3.721346863509308*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "2", ",", "0", ",", "1", ",", "0", ",", "1", ",", "2", ",", "1", ",", "2",
      ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2", ",", "1", ",", "0", ",", "2", ",", "1", ",", "0", ",", "2", ",", "1",
      ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2", ",", "2", ",", "2", ",", "1", ",", "1", ",", "1", ",", "0", ",", "0",
      ",", "0"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.7213460631988907`*^9, 3.7213460951939583`*^9}, 
   3.7213461359052734`*^9, 3.7213461860287695`*^9, {3.7213463775314703`*^9, 
   3.721346394811767*^9}, {3.7213464292668896`*^9, 3.721346435678153*^9}, 
   3.7213464666849685`*^9, 3.7213465105217257`*^9, {3.7213465469396315`*^9, 
   3.7213465702657924`*^9}, {3.7213466046506157`*^9, 3.721346609381729*^9}, 
   3.7213467507249618`*^9, 3.7213467952532606`*^9, 3.7213468639624176`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ListasDiferenca", "[", 
  RowBox[{
   RowBox[{"ExpandTemplate", "[", 
    RowBox[{"ColorBlindTemplate", "[", 
     RowBox[{"3", ",", " ", "0.5"}], "]"}], "]"}], ",", " ", 
   RowBox[{"ExpandTemplate", "[", 
    RowBox[{"StateConservingTemplate", "[", 
     RowBox[{"3", ",", " ", "0.5"}], "]"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.721346238230925*^9, 3.721346297677369*^9}, {
  3.7213466290774145`*^9, 3.7213466417689147`*^9}, {3.7213467913810053`*^9, 
  3.7213467922845163`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
   "2", ",", "0", ",", "1", ",", "0", ",", "1", ",", "2", ",", "1", ",", "2", 
    ",", "0"}], "}"}], "}"}]], "Output",
 CellChangeTimes->{{3.721346232059022*^9, 3.7213462979898677`*^9}, 
   3.721346642940775*^9, {3.7213467002335415`*^9, 3.7213467104458117`*^9}, 
   3.7213467531719875`*^9, {3.7213467928001156`*^9, 3.721346797115503*^9}, 
   3.7213468750912576`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ColorBlindTemplate", "[", 
  RowBox[{"3", ",", " ", "0.5"}], "]"}]], "Input",
 CellChangeTimes->{{3.7213466763289413`*^9, 3.721346697842913*^9}, {
  3.721346785005748*^9, 3.721346824538393*^9}, {3.721347047266322*^9, 
  3.7213470515944595`*^9}}],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"\<\"k\"\>", "\[Rule]", "3"}], ",", 
   RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
   RowBox[{"\<\"core\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"2", ",", 
      RowBox[{"2", "-", "x1"}], ",", 
      RowBox[{"2", "-", 
       RowBox[{"2", " ", "x1"}]}], ",", 
      RowBox[{"1", "-", 
       RowBox[{"2", " ", "x1"}]}], ",", "1", ",", 
      RowBox[{"1", "+", 
       RowBox[{"2", " ", "x1"}]}], ",", 
      RowBox[{"2", " ", "x1"}], ",", "x1", ",", "0"}], "}"}]}], ",", 
   RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"FilterNotAllowed", ",", "ModK"}], "}"}]}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{3.7213470519538164`*^9, 3.721348285742432*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"StateConservingTemplate", "[", 
  RowBox[{"3", ",", " ", "0.5"}], "]"}]], "Input",
 CellChangeTimes->{{3.721346816723083*^9, 3.7213468283205976`*^9}, {
  3.721346912315662*^9, 3.7213469138312902`*^9}}],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"\<\"k\"\>", "\[Rule]", "3"}], ",", 
   RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
   RowBox[{"\<\"core\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"2", ",", 
      RowBox[{"2", "+", "x1", "-", "x2"}], ",", 
      RowBox[{"2", "-", "x2"}], ",", 
      RowBox[{"1", "-", "x1", "+", "x2"}], ",", "1", ",", 
      RowBox[{"1", "-", "x1"}], ",", "x2", ",", "x1", ",", "0"}], "}"}]}], 
   ",", 
   RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", "FilterOutOfRange"}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{{3.721346817207432*^9, 3.7213468288518353`*^9}, 
   3.721346914471901*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"OperacaoDiferenca", "[", " ", 
   RowBox[{
    RowBox[{"ColorBlindTemplate", "[", 
     RowBox[{"3", ",", " ", "0.5"}], "]"}], ",", " ", 
    RowBox[{"StateConservingTemplate", "[", 
     RowBox[{"3", ",", " ", "0.5"}], "]"}]}], "]"}], "[", 
  RowBox[{"[", "2", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7213469806828094`*^9, 3.7213470290777225`*^9}}],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"\<\"k\"\>", "\[Rule]", "3"}], ",", 
   RowBox[{"\<\"r\"\>", "\[Rule]", "0.5`"}], ",", 
   RowBox[{"\<\"core\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"2", ",", 
      RowBox[{
       RowBox[{"2", "-", "x1"}], "\[Element]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"2", "+", "x1", "-", "x2"}], "\[Equal]", 
            RowBox[{"Mod", "[", 
             RowBox[{
              RowBox[{"2", "+", "x1", "-", "x2"}], ",", "3"}], "]"}]}], ",", 
           RowBox[{"-", "1"}], ",", 
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{"2", "+", "x1", "-", "x2"}], ",", "3"}], "]"}]}], "]"}], 
         ",", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"3", "+", "x1", "-", "x2"}], ",", "3"}], "]"}], ",", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"4", "+", "x1", "-", "x2"}], ",", "3"}], "]"}]}], "}"}]}], 
      ",", 
      RowBox[{"2", "-", 
       RowBox[{"2", " ", "x1"}]}], ",", 
      RowBox[{"1", "-", 
       RowBox[{"2", " ", "x1"}]}], ",", "1", ",", 
      RowBox[{"1", "+", 
       RowBox[{"2", " ", "x1"}]}], ",", 
      RowBox[{"2", " ", "x1"}], ",", "x1", ",", "0"}], "}"}]}], ",", 
   RowBox[{"\<\"postExpansionFn\"\>", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"FilterNotAllowed", ",", "ModK"}], "}"}]}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{
  3.721346888500827*^9, {3.7213469901318135`*^9, 3.721347029437087*^9}, 
   3.7213472241268916`*^9, 3.7213482475655513`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ExpandTemplate", "[", 
  RowBox[{"BuildTemplate", "[", 
   RowBox[{"3", ",", " ", "0.5", ",", " ", 
    RowBox[{"{", 
     RowBox[{"2", " ", ",", 
      RowBox[{
       RowBox[{"2", "-", "x1"}], " ", "\[NotElement]", " ", 
       RowBox[{"{", "0", "}"}]}], ",", 
      RowBox[{"2", "-", 
       RowBox[{"2", " ", "x1"}]}], ",", 
      RowBox[{"1", "-", 
       RowBox[{"2", " ", "x1"}]}], ",", "1", ",", 
      RowBox[{"1", "+", 
       RowBox[{"2", " ", "x1"}]}], ",", 
      RowBox[{"2", " ", "x1"}], ",", "x1", ",", "0"}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"FilterNotElement", ",", " ", "ModK"}], "}"}]}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.7213473440993023`*^9, 3.7213474694550037`*^9}, {
   3.7213481547885284`*^9, 3.7213481700974903`*^9}, {3.721348273426259*^9, 
   3.7213484258566847`*^9}, {3.7213485419437284`*^9, 
   3.7213485771478662`*^9}, {3.72134863060769*^9, 3.721348637830573*^9}, {
   3.7213488298122597`*^9, 3.7213488316987486`*^9}, 3.72134886601663*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "2", ",", "2", ",", "2", ",", "1", ",", "1", ",", "1", ",", "0", ",", "0",
      ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2", ",", "1", ",", "0", ",", "2", ",", "1", ",", "0", ",", "2", ",", "1",
      ",", "0"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.721347378411807*^9, 3.721347427536189*^9}, {
   3.7213474644705873`*^9, 3.7213474701756983`*^9}, 3.7213481561368756`*^9, {
   3.721348202409862*^9, 3.7213482140048547`*^9}, {3.721348276108926*^9, 
   3.721348387056655*^9}, {3.7213484216856184`*^9, 3.721348426440847*^9}, {
   3.7213485324102736`*^9, 3.7213485783781586`*^9}, 3.7213486389078255`*^9, 
   3.7213488323458977`*^9, 3.721348866984854*^9}]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7213473815222335`*^9, 3.7213473821628747`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FilterNotElement", "[", 
    RowBox[{"template_Association", ",", "expansion_List"}], "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"memberQsInHold", "=", 
       RowBox[{"Cases", "[", 
        RowBox[{"expansion", ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"value_", "\[NotElement]", "set_List"}], "\[Rule]", 
           RowBox[{"Hold", "[", 
            RowBox[{"MemberQ", "[", 
             RowBox[{"set", ",", "value"}], "]"}], "]"}]}], ")"}], ",", 
         "Infinity"}], "]"}]}], "}"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"And", "@@", 
         RowBox[{"(", 
          RowBox[{"ReleaseHold", "/@", "memberQsInHold"}], ")"}]}], 
        "\[Equal]", "True"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"(", "##", ")"}], "&"}], "[", "]"}], ",", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "At", " ", "least", " ", "one", " ", "of", " ", "the", " ", 
          "expressions", " ", "is", " ", "invalid"}], ",", 
         RowBox[{
         "this", " ", "expansion", " ", "should", " ", "be", " ", 
          "filtered"}]}], "*)"}], 
       RowBox[{"expansion", "/.", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"value_", " ", "\[NotElement]", " ", "set_List"}], 
          "\[Rule]", "value"}], ")"}]}]}], "]"}]}], "]"}]}], ";", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"All", " ", "expressions", " ", "are", " ", "valid"}], ",", 
    RowBox[{"this", " ", "expansion", " ", "is", " ", 
     RowBox[{"ok", "."}]}]}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.721348141274047*^9, 3.721348150505437*^9}, {
  3.721348194285777*^9, 3.721348210705011*^9}, {3.7213484818672075`*^9, 
  3.7213485498708076`*^9}}]
},
WindowSize->{1898, 997},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.0 for Microsoft Windows (64-bit) (September 21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 56, 1, 30, "Input"],
Cell[617, 23, 2096, 58, 69, "Input"],
Cell[2716, 83, 8365, 179, 240, "Input"],
Cell[11084, 264, 69, 1, 30, "Input"],
Cell[11156, 267, 9483, 202, 221, "Input"],
Cell[CellGroupData[{
Cell[20664, 473, 1337, 34, 30, InheritFromParent],
Cell[22004, 509, 587, 13, 30, "Output"]
}, Open  ]],
Cell[22606, 525, 94, 1, 30, "Input"],
Cell[22703, 528, 658, 19, 30, "Input"],
Cell[CellGroupData[{
Cell[23386, 551, 1460, 31, 30, "Input"],
Cell[24849, 584, 1118, 28, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[26004, 617, 1797, 43, 30, "Input"],
Cell[27804, 662, 421, 9, 21, "Message"],
Cell[28228, 673, 422, 9, 21, "Message"],
Cell[28653, 684, 422, 9, 21, "Message"],
Cell[29078, 695, 418, 9, 21, "Message"],
Cell[29499, 706, 16294, 394, 198, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[45830, 1105, 358, 5, 30, "Input"],
Cell[46191, 1112, 143, 3, 30, "Output"]
}, Open  ]],
Cell[46349, 1118, 429, 9, 30, "Input"],
Cell[CellGroupData[{
Cell[46803, 1131, 859, 24, 30, "Input"],
Cell[47665, 1157, 178, 2, 30, "Output"]
}, Open  ]],
Cell[47858, 1162, 543, 12, 30, "Input"],
Cell[CellGroupData[{
Cell[48426, 1178, 814, 23, 30, "Input"],
Cell[49243, 1203, 345, 8, 30, "Output"]
}, Open  ]],
Cell[49603, 1214, 929, 20, 30, "Input"],
Cell[50535, 1236, 646, 14, 30, "Input"],
Cell[CellGroupData[{
Cell[51206, 1254, 532, 10, 30, "Input"],
Cell[51741, 1266, 347, 5, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[52125, 1276, 627, 12, 30, "Input"],
Cell[52755, 1290, 925, 20, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[53717, 1315, 517, 11, 30, "Input"],
Cell[54237, 1328, 424, 9, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[54698, 1342, 269, 5, 30, "Input"],
Cell[54970, 1349, 784, 20, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[55791, 1374, 225, 4, 30, "Input"],
Cell[56019, 1380, 673, 16, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[56729, 1401, 390, 9, 30, "Input"],
Cell[57122, 1412, 1635, 44, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[58794, 1461, 1024, 23, 30, "Input"],
Cell[59821, 1486, 755, 16, 30, "Output"]
}, Open  ]],
Cell[60591, 1505, 96, 1, 30, "Input"],
Cell[60690, 1508, 1809, 48, 88, "Input"]
}
]
*)

